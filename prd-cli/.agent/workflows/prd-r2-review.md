# R2 版本审视工作流

---

## 🚨 本阶段必须遵守的规则

> ⚠️ AI 在执行任务前必须逐条确认以下规则。输出时需包含自检清单。

| ID | 规则 | 严重程度 | 自检 |
|----|------|----------|------|
| G001 | 所有回复必须使用简体中文 | 🔴 严重 | ☐ |
| G002 | 禁止未经对话就填充文档，必须通过提问引导 PM 填写 | 🔴 严重 | ☐ |
| G003 | 禁止替 PM 做决策（优先级/范围/目标由 PM 决定） | 🔴 严重 | ☐ |
| G004 | 禁止'快速完成'跳过流程，每个阶段都要充分对话和审视 | 🔴 严重 | ☐ |
| D005 | 文档状态变更后必须同步更新 .prd-config.json | 🟠 高 | ☐ |
| S004 | 新需求正确流程：暂存 A2 → 新迭代 → B1 处理 | 🟠 高 | ☐ |
| I001 | 确认一个需求，立即写入文件（铁律） | 🔴 严重 | ☐ |
| I002 | 禁止聊完全部需求后一次性写入 | 🔴 严重 | ☐ |
| I003 | 完成章节/确认 3 个需求项/10 轮对话后必须保存 | 🟠 高 | ☐ |
| I004 | 切换讨论主题前必须保存当前内容 | 🟠 高 | ☐ |
| C003 | 禁止'只记录 PM 说的，不追问遗漏的' | 🟠 高 | ☐ |
| W001 | 开始工作前，必须查看 .prd-config.json 了解项目状态 | 🟠 高 | ☐ |
| W002 | 开始工作前，必须确认哪些文档已冻结 | 🟠 高 | ☐ |

**自检清单模板**（AI 输出时必须包含）：
```
## ✅ 规则自检 (R2)
- [ ] G001: 所有回复必须使用简体中文...
- [ ] G002: 禁止未经对话就填充文档，必须通过提问引导 PM 填写...
- [ ] G003: 禁止替 PM 做决策（优先级/范围/目标由 PM 决定）...
- [ ] G004: 禁止'快速完成'跳过流程，每个阶段都要充分对话和审视...
- [ ] D005: 文档状态变更后必须同步更新 .prd-config.json...
- [ ] S004: 新需求正确流程：暂存 A2 → 新迭代 → B1 处理...
- [ ] I001: 确认一个需求，立即写入文件（铁律）...
- [ ] I002: 禁止聊完全部需求后一次性写入...
- [ ] I003: 完成章节/确认 3 个需求项/10 轮对话后必须保存...
- [ ] I004: 切换讨论主题前必须保存当前内容...
- [ ] C003: 禁止'只记录 PM 说的，不追问遗漏的'...
- [ ] W001: 开始工作前，必须查看 .prd-config.json 了解...
- [ ] W002: 开始工作前，必须确认哪些文档已冻结...
```

---


本工作流用于执行 R2 版本审视，判断版本需求是否忠实于规划。

---

## 🛡️ 核心准则：PM 判定，AI 执行

1. **忠实性审计**：AI 只审计 C0/C1 是否偏离了 B3。
2. **严禁代签**：涉及版本承诺、交付清单、C3 冻结签名时，AI 严禁操作。
3. **禁止静默通过**：如果版本需求（C1）超出了规划（B3），AI 必须大声指出。

---

## 🎯 R2 审视的本质：忠实性审计 + 战略思维

R2 的核心使命只有一句话：
> **判断该版本是否忠实执行了已冻结的规划（B3）**

但审计不是简单对比，需要用**结构化思维**进行深度分析。

### 核心思维框架：

```
Step 1: 以终为始 → B3 的目标是什么？C0 是否一致？
Step 2: 结构化拆解 → B2 的需求项是否完整映射到 C1？
Step 3: 多维决策 → 构建一致性矩阵评估偏离度
```

---

## 📋 R2 审视的严格标准

### 维度 1：版本目标一致性（以终为始）

**AI 必须拷问：**

1. **目标对齐检查**
   ```
   审视问题：
   - B3 冻结的规划目标是什么？
   - C0 的版本目标是对 B3 的"版本化翻译"吗？
   - C0 是否引入了 B3 没有的新目标？
   
   错误示例：
   B3: "优化创建流程"
   C0: "打造行业领先的 BP 管理平台" ← 目标升级了！偏离！
   ```

2. **Gap 一致性**
   ```
   审视问题：
   - B1 识别的 Gap（差距），C0 是否还在解决同一个 Gap？
   - C0 是否偷偷换了要解决的问题？
   
   警告信号：
   - B1 说解决"用户创建困难"
   - C0 说解决"系统性能问题" ← 换问题了！
   ```

3. **承诺范围检查**
   ```
   审视问题：
   - C0 的"包含范围"是 B3 的子集吗？
   - C0 的"不包含"是 B3 明确延后的部分吗？
   - C0 是否承诺了 B3 范围之外的内容？
   ```

**构建一致性矩阵**：

| 项目 | B3 冻结内容 | C0 实际内容 | 一致性 | 问题 |
|-----|-----------|-----------|-------|-----|
| 核心目标 | 优化创建流程 | 优化创建流程 | ✅ | 无 |
| 解决的 Gap | 用户困惑 | 用户困惑 | ✅ | 无 |
| 包含范围 | 进度指示、保存确认 | 进度指示、保存确认、**批量启动** | ❌ | 多了"批量启动" |

**评估结果**：目标一致性 = 66%，**不通过**

---

### 维度 2：版本范围偏移检查

**AI 必须用 MECE 原则检查：**

1. **完整映射检查（CE - Collectively Exhaustive）**
   ```
   审视问题：
   - B2 首版包含的所有需求项，C1 是否都有对应？
   - 构建映射矩阵：
   
   B2 需求项 | C1 对应 | 是否遗漏
   ---------|--------|--------
   REQ-001  | C1-001 | ✅
   REQ-002  | 无     | ❌ 遗漏！
   REQ-003  | C1-003 | ✅
   ```

2. **无新增检查（ME - Mutually Exclusive）**
   ```
   审视问题：
   - C1 中是否存在 B2 没有的需求项？
   - 如果有，这些是"细化"还是"新增"？
   
   区分标准：
   - 细化：将 B2 的一个需求项拆分为详细验收标准 ← 允许
   - 新增：出现了 B2 完全没有提到的功能 ← 禁止
   
   示例：
   B2: "进度指示器"
   C1: "进度指示器的动画效果" ← 细化，允许
   C1: "AI 智能填充" ← 新增，禁止！
   ```

3. **范围偏移量化**
   ```
   计算公式：
   偏移度 = (C1 新增项 + B2 遗漏项) / B2 总项数
   
   通过标准：
   - 偏移度 ＜ 5% → 可接受
   - 偏移度 5%-10% → 需要说明理由
   - 偏移度 ＞ 10% → 不通过，必须回到 B3 重新规划
   ```

---

### 维度 3：规划覆盖完整性

**AI 必须检查 B3 冻结的承诺是否完整实现：**

1. **"不做什么"的忠实度**
   ```
   审视问题：
   - B3 明确说"不做"的内容，C0/C1 是否真的没做？
   
   警告信号：
   - B3: "本轮不做审批流程"
   - C1: "需求 #10 - 审批流程一期" ← 违背承诺！
   ```

2. **优先级一致性**
   ```
   审视问题：
   - B2 的 P0 需求，C1 是否都标为 P0？
   - 是否存在 B2 的 P2 变成 C1 的 P0？（逆向升级）
   - 是否存在 B2 的 P0 变成 C1 的 P1？（降级）
   
   构建优先级偏移矩阵：
   
   需求 | B2 优先级 | C1 优先级 | 是否一致
   ----|---------|---------|--------
   #001| P0      | P0      | ✅
   #002| P1      | P0      | ❌ 升级了
   #003| P0      | P1      | ❌ 降级了
   ```

---

### 维度 4：需求粒度成熟度

**AI 必须检查 C1 是否可执行：**

1. **验收标准检查**
   ```
   审视问题：
   - C1 的每个需求项是否有明确的验收标准？
   - 验收标准是否可测试、可验证？
   
   错误示例：
   ❌ "用户体验提升" ← 无法验证
   ✅ "创建过程点击次数从 12 次降至 6 次以下" ← 可验证
   ```

2. **需求可追溯性**
   ```
   审视问题：
   - C1 的每个需求能否追溯到 B2？（必须标注来源）
   - 是否存在"来源：无"的需求？← 新增需求，违规
   
   构建追溯矩阵：
   
   C1 需求 | 来源（B2） | 可追溯性
   -------|----------|--------
   C1-001 | REQ-001  | ✅
   C1-002 | 无       | ❌ 来源不明
   ```

3. **依赖关系完整性**
   ```
   审视问题：
   - B2 中标注的依赖关系，C1 是否保留？
   - C1 是否破坏了 B2 的依赖逻辑？
   ```

---

### 维度 5：进入执行准备度

**AI 必须检查版本需求是否可交付：**

1. **CSF 保留检查**
   ```
   审视问题：
   - B2 中识别的 CSF（关键成功因素），C1 是否都保留了？
   - C1 是否错误地砍掉了 CSF？
   
   警告信号：
   - B2: "进度指示器是 CSF（P0）"
   - C1: "进度指示器降为 P1，首版不做" ← 砍 CSF，严重错误！
   ```

2. **执行可行性：二元问题拒绝**
   ```
   不再问：
   - ❌ "要不要做这个？"
   - ❌ "值得做吗？"
   
   只问：
   - ✅ "如何做好这个？"
   - ✅ "边界条件是什么？"
   ```

3. **交付清晰度**
   ```
   审视问题：
   - 研发团队拿到 C1 后，能否直接开始设计和编码？
   - 是否还需要回来追问"这个需求具体要什么"？
   ```

---

### 维度 6：用户视角审查（关键！）

**⚠️ 这是 R2 审视中最重要的维度之一！**

**背景问题**：
很多时候，PM 按自己的理解去规划需求，结果交付给用户后用户不满意。
即使需求很"清楚"，也可能不是用户真正想要的。

**AI 必须站在用户角度审视每个需求：**

1. **用户感知审查**
   ```
   审视问题：
   - 用户看到这个功能的第一反应是什么？
   - 用户能立即理解如何使用吗？
   - 用户会觉得这个功能"好用"吗？
   
   构建用户感知矩阵：
   
   | 需求 | 用户第一反应 | 易用性 | 感知价值 | 问题 |
   |-----|-------------|-------|---------|------|
   | #001 | 清晰明了 | ✅ 直观 | 高 | 无 |
   | #002 | 困惑 | ❌ 需学习 | 中 | 需简化 |
   | #003 | 不理解 | ❌ 复杂 | 低 | 重新设计 |
   ```

2. **用户问题匹配度**
   ```
   审视问题：
   - 这个需求解决的是用户的真实痛点吗？
   - 还是 PM 自己"认为"用户需要的？
   - A2 中有没有用户反馈支撑这个需求？
   
   验证方法：
   - 需求 → 追溯到 A2 用户反馈 → 反馈是否真的描述了这个问题？
   
   警告信号：
   - 需求在 A2 中找不到用户反馈 ← 可能是 PM 臆想
   - A2 反馈说的是 X，但需求解决的是 Y ← 理解偏差
   ```

3. **用户使用场景还原**
   ```
   审视问题：
   - 用户会在什么场景下使用这个功能？
   - 用户使用时的操作流程是什么？
   - 有没有考虑用户的"实际行为"而非"理想行为"？
   
   AI 必须模拟用户使用：
   "假设我是用户，我要完成 [任务]：
    1. 我首先会...
    2. 然后我会...
    3. 最后我期望...
    
    C1 中描述的流程是否符合我的预期？
    有什么让我觉得'不顺'的地方？"
   ```

4. **用户满意度预测**
   ```
   审视问题（AI 必须回答）：
   
   Q1: 如果用户今天就用到这个功能，他会满意吗？
       - ✅ 会满意（说明原因）
       - ⚠️ 基本满意，但有改进空间
       - ❌ 可能不满意（说明原因）
   
   Q2: 用户会不会说"这不是我想要的"？
       - 如果会，是哪个需求？为什么？
   
   Q3: 交付后用户投诉的可能性？
       - 高风险需求有哪些？
   ```

5. **用户视角改进建议**
   ```
   AI 必须给出：
   
   📝 用户视角发现的问题：
   1. [问题1]：[描述]
   2. [问题2]：[描述]
   
   💡 用户视角改进建议：
   1. [建议1]：[原因]
   2. [建议2]：[原因]
   
   ⚠️ 高风险需求（用户可能不满意）：
   1. [需求X]：[风险原因]
   ```

**用户视角审查的核心原则**：
- ❌ 不要只看"需求是否完整"
- ❌ 不要只看"是否符合 B3"
- ✅ 要看"用户用起来舒不舒服"
- ✅ 要看"这真的解决了用户的问题吗"
- ✅ 要看"用户会不会买账"

**AI 审视话术**：
```
AI: "现在我从用户视角审视这些需求：

     📊 用户感知分析：
     
     需求 #1 - 进度指示器：
     - 用户第一反应：✅ 能立即理解
     - 使用体验：✅ 直观
     - 满意度预测：高
     
     需求 #2 - 批量操作：
     - 用户第一反应：⚠️ 需要学习
     - 使用体验：❌ 步骤较多
     - 满意度预测：中
     - 改进建议：简化操作步骤，增加引导
     
     需求 #3 - 审批流程：
     - 用户第一反应：❓ 不确定用途
     - 使用体验：❌ 流程复杂
     - 满意度预测：低
     - 问题：A2 中用户反馈的是'快速创建'，
             但这个需求增加了审批环节，
             可能与用户期望相反。
     
     🚨 高风险提醒：
     需求 #3 的用户满意度预测较低，
     建议重新考虑是否符合用户真实需求。
     
     PM 请确认：是否接受以上用户视角分析？"
```

---

## 🔍 审视执行方法：忠实度矩阵

**AI 必须构建详细的忠实度分析矩阵：**

### 完整映射矩阵示例

| B2 需求 | 优先级 | C1 对应 | 优先级 | 验收标准 | 一致性评分 | 问题 |
|--------|-------|--------|-------|---------|----------|-----|
| REQ-001 | P0 | C1-001 | P0 | ✅ 清晰 | 100% | 无 |
| REQ-002 | P0 | 无 | - | - | 0% | 遗漏了 |
| REQ-003 | P1 | C1-003 | P0 | ✅ 清晰 | 50% | 优先级升级 |
| 无 | - | C1-004 | P0 | ⚠️ 模糊 | 0% | 新增需求 |

**汇总分析**：
- 完整性：75%（遗漏 1 项）
- 忠实度：62.5%（1 项新增 + 1 项优先级偏移）
- 可执行性：75%（1 项验收标准模糊）

**综合评估**：70.8%，**不通过（≥85% 才通过）**

---

## 💬 苏格拉底式审视对话

**AI 发现问题时的对话方式：**

```
AI: "我注意到 C1 中出现了'批量启动'功能。
     
     请问，这个功能在 B3 的规划范围中吗？"

PM: "呃...好像没有..."

AI: "让我确认一下。
     
     B3 冻结的规划目标是'优化单个创建流程'。
     '批量启动'是新增功能，不在 B3 范围内。
     
     根据规范，C 阶段禁止新增规划外需求。
     
     您有两个选择：
     1. 从 C1 中移除'批量启动'，放入下一轮规划
     2. 解冻 B3，重新走 R1 审视流程
     
     请问您选择哪个？"

PM: [做决定]

AI: "好的，我按您的决定处理。同时我会在 R2 报告中记录这个偏移点。"
```

---

## 📊 最终决策矩阵

**AI 必须输出完整的评估矩阵：**

| 维度 | 权重 | 评分 | 加权分 | 关键问题 |
|-----|-----|-----|-------|---------|
| 版本目标一致性 | 20% | 66% | 13.2 | C0 多了新目标 |
| 版本范围偏移检查 | 25% | 75% | 18.75 | C1 有新增需求 |
| 规划覆盖完整性 | 15% | 62% | 9.3 | 违背了"不做"承诺 |
| 需求粒度成熟度 | 10% | 80% | 8.0 | 部分验收标准模糊 |
| 进入执行准备度 | 10% | 90% | 9.0 | CSF 保留完整 |
| **用户视角审查** | **20%** | 60% | 12.0 | 部分需求用户感知差 |
| **总分** | 100% | - | **70.25** | **不通过（≥85% 才通过）** |

**结论**：
- [ ] ✅ 通过
- [ ] ⚠️ 有条件通过
- [x] ❌ 不通过（必须修正）

**不通过原因**：
1. C1 引入了 B3 范围外的需求（批量启动）
2. C0 扩大了版本目标（从"优化流程"变"打造平台"）
3. 违背了 B3 的"不做审批"承诺
4. **用户视角问题：部分需求未站在用户角度设计**

**改进要求**：
1. 从 C1 移除所有 B2 没有的需求项
2. 将 C0 目标改回与 B3 一致
3. 移除 C1 中的审批相关需求

---

## ⚠️ AI 行为红线

### AI 绝对禁止：

1. ❌ "基本符合 B3，可以通过" ← 没有严格比对
2. ❌ "细微偏差可以接受" ← 放松标准
3. ❌ 不构建映射矩阵就给结论 ← 缺乏证据
4. ❌ 发现新增需求不追问 ← 静默通过
5. ❌ 说"这个需求合理，可以加" ← 越权判断

### AI 必须做到：

1. ✅ 构建 B2→C1 的完整映射矩阵
2. ✅ 量化偏移度并展示证据
3. ✅ 发现任何新增需求都要明确指出
4. ✅ 用苏格拉底式提问引导 PM 决策
5. ✅ 记录所有偏移点到 R2 报告

---

## 🔄 忠实性审计的三问

**AI 在审视时必须反复问自己：**

1. **"这是基于 B3 的执行，还是重新规划？"**
   - 如果 C1 和 B2 差异 ＞ 10%，这不是执行，是重新规划

2. **"研发拿到 C1 后，会不会说'这和 B3 说的不一样'？"**
   - 如果会，说明偏离了

3. **"如果 B3 冻结时 PM 知道会变成这样，他还会签字吗？"**
   - 如果不会，说明背叛了承诺

---

**本工作流确保版本需求（C0/C1）忠实于规划（B3），拒绝一切形式的"规划外加戏"！**
