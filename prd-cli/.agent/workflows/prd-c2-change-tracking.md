# C2 版本变更工作流

本工作流用于记录版本冻结后发生的变更，确保变更可追溯、可审计。

---

## 🎯 C2 的本质：变更记录与影响追溯

C2 不是随意修改需求的"后门"，而是**严格记录变更的审计文档**。

### 核心原则：

```
1. 变更必须记录
2. 影响必须评估
3. PM 必须确认
```

---

## 📋 C2 的触发时机

### 什么时候创建 C2？

| 情况 | 是否需要 C2 |
|-----|-----------|
| C3 冻结后，需求完全不变 | ❌ 不需要 |
| C3 冻结后，修改了某个需求 | ✅ 需要 |
| C3 冻结后，删除了某个需求 | ✅ 需要 |
| C3 冻结后，新增了需求 | ✅ 需要（且可能需要重新 R2）|
| C3 冻结后，调整了优先级 | ✅ 需要 |

**命令**：`prd change` → 选择"创建 C2" 或 `prd version create C2`

---

## 🔍 AI 的职责：自动对比与提醒

### Step 1: 自动生成差异对比清单

**AI 必须做的（自动化）**：

```
AI: "我检测到 C1 或 C3 可能发生了变更。
     
     让我生成差异对比清单：
     
     1. 对比冻结版本（C3）与当前状态
     2. 识别所有差异点
     3. 分类差异类型
     
     正在分析..."
```

**AI 输出：差异对比矩阵**

| 需求 | 冻结版（C3）| 当前状态 | 差异类型 | 影响评估 |
|-----|-----------|---------|---------|---------|
| REQ-001 | P0 | P1 | 优先级降级 | ⚠️ 影响交付 |
| REQ-002 | 存在 | 删除 | 需求删除 | ⚠️ 影响范围 |
| REQ-005 | 不存在 | 新增 | 新增需求 | ❌ 违反规范 |

---

### Step 2: 映射到来源（可追溯性）

**AI 必须追溯每个变更的来源：**

```
AI: "差异项 #1：REQ-001 优先级从 P0 降为 P1
     
     追溯分析：
     - 来源：B2 需求项 #1（优先级 P0）
     - B3 冻结时：确认为 P0（CSF）
     - C1 中：标记为 P0
     - C3 冻结时：P0
     - 当前状态：P1 ← 发生变更
     
     ⚠️ 这是 CSF（关键成功因素）的降级，影响重大！"
```

---

### Step 3: 触发重新审视提醒

**AI 必须检查是否需要重新审视：**

```
AI: "变更影响评估：
     
     轻微变更（无需重新审视）：
     - 细化验收标准
     - 补充边界说明
     
     重大变更（需要重新 R2 审视）：
     - ❌ 新增需求（REQ-005）
     - ⚠️ CSF 降级（REQ-001）
     - ⚠️ 删除需求（REQ-002）
     
     建议：需要重新执行 R2 审视。
     
     是否触发重新审视？（由 PM 决定）"
```

---

## 💬 PM 的职责：确认与决策

### PM 必须做的（不可替代）：

#### 1. 确认变更事实

```
AI: "检测到以下变更，请确认：
     
     1. REQ-001 优先级降级（P0 → P1）
        - 是否属实？
        - 变更原因是什么？
     
     2. REQ-005 新增
        - 是否属实？
        - 为什么新增（需求变更/遗漏/策略调整）？
     
     请逐项确认。"

PM: [确认并说明原因]
```

#### 2. 确认变更原因归因

**AI 提供选项，PM 选择**：

```
AI: "REQ-005 新增的原因归因：
     
     - [ ] 需求变更（业务方新增需求）
     - [ ] 外部依赖变化（第三方接口调整）
     - [ ] 策略调整（公司战略变化）
     - [ ] 前期遗漏（B3/C1 时遗漏了）
     - [ ] 其他（请说明）
     
     请选择归因类型。"
```

#### 3. 评估变更影响

**AI 提供影响矩阵，PM 决策**：

```
AI: "变更影响评估：
     
     | 维度 | 影响评估 |
     |-----|---------|
     | 范围 | 扩大了 10%（新增 1 个需求）|
     | 承诺 | 违反了 C3 的版本承诺 |
     | 节奏 | 可能延期 2 周 |
     | 资源 | 需要额外 30 人天 |
     
     请问这个变更影响是否可接受？"

PM: [决策：接受 / 拒绝 / 调整]
```

---

## 📊 C2 输出格式

**AI 必须生成完整的 C2 变更记录：**

```markdown
# C2_版本变更说明

**创建时间**: 2025-12-19
**变更批次**: #1

---

## 1. 变更概述

**变更类型统计**:
- 新增需求：1 项
- 删除需求：1 项
- 优先级调整：1 项
- 细节修改：0 项

**总变更率**: 15%（3 项 / 20 项总需求）

---

## 2. 变更明细

### 变更 #1：REQ-001 优先级降级

**变更时间**: 2025-12-19 10:00
**变更人**: PM 侯桐

**变更内容**:
- 冻结版：P0（CSF）
- 当前版：P1

**变更原因**（PM 确认）:
- 归因类型：策略调整
- 具体原因：公司决定先上线核心流程，进度指示延后

**来源追溯**:
- B2 需求项 #1
- B3 冻结时确认为 CSF
- C1 中标记为 P0
- C3 冻结时为 P0

**影响评估**（PM 确认）:
- 范围影响：无（仍在版本内）
- 承诺影响：⚠️ 违反 CSF 承诺
- 节奏影响：可能影响用户体验
- 资源影响：节省 15 人天

**PM 决策**: ✅ 接受变更

---

### 变更 #2：REQ-005 新增需求

**变更时间**: 2025-12-19 10:30
**变更人**: PM 侯桐

**变更内容**:
- 冻结版：不存在
- 当前版：新增（批量启动功能）

**变更原因**（PM 确认）:
- 归因类型：需求变更
- 具体原因：业务方紧急需求，CEO 特批

**来源追溯**:
- ❌ B2 中不存在
- ❌ B3 范围外
- ❌ C1 中不存在

**影响评估**（PM 确认）:
- 范围影响：🔴 扩大 10%
- 承诺影响：🔴 违反版本承诺
- 节奏影响：🔴 延期 2 周
- 资源影响：🔴 额外 30 人天

**PM 决策**: ⚠️ 接受但需重新 R2 审视

---

## 3. 差异对比清单

| 需求 | 冻结版 | 当前 | 差异类型 | PM决策 |
|-----|-------|-----|---------|-------|
| REQ-001 | P0 | P1 | 优先级降级 | ✅ 接受 |
| REQ-002 | 存在 | 删除 | 需求删除 | ✅ 接受 |
| REQ-005 | 不存在 | 新增 | 新增需求 | ⚠️ 重审 |

---

## 4. 重新审视要求

**是否需要重新 R2 审视**: ✅ 需要

**理由**:
- 新增了规划外需求（REQ-005）
- CSF 被降级（REQ-001）

**R2 审视状态**: 
- [ ] 未执行
- [ ] 执行中
- [ ] 已通过

---

## 5. PM 最终确认

**PM 签字**: 侯桐
**确认日期**: 2025-12-19
**确认声明**: 

我确认上述变更的原因、影响评估和决策，并对变更后果负责。

---

## 6. 审计追溯

**变更记录索引**: C2-001
**关联文档**:
- B3_规划冻结归档.md
- C1_版本需求清单.md
- C3_版本冻结归档.md

**下一步**:
- [ ] 执行 R2 重新审视
- [ ] 更新 C3
- [ ] 通知相关方
```

---

## ⚠️ AI 行为红线

### AI 绝对禁止：

1. ❌ 在 C2 中"顺手新增需求"（只记录，不决策）
2. ❌ 以记录差异为名扩大范围
3. ❌ 替 PM 宣布"变更可接受"
4. ❌ 自动修改 C1 或 C3（必须通过正规流程）
5. ❌ 隐藏重大变更（必须明确标注）

### AI 必须做到：

1. ✅ 自动生成差异对比清单
2. ✅ 追溯每个变更的来源
3. ✅ 提醒是否需要重新审视
4. ✅ 提供影响评估矩阵（由 PM 决策）
5. ✅ 完整记录 PM 的确认和决策

---

**本工作流确保版本变更可追溯、可审计，防止"偷偷改需求"！**
