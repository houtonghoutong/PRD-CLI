---
description: A1 代码扫描 - 自动生成功能清单
---

# A1 代码扫描工作流

> ⚠️ **A1 是自动生成的文档，禁止手动维护！**

本工作流指导 AI 扫描项目代码，自动生成或更新 `A1_代码功能快照.md`。

---

## 🎯 触发条件

当 PM 说以下内容时，AI 应主动执行此工作流：
- "扫描一下现在的功能"
- "更新 A1"
- "看看代码里有什么功能"
- "同步一下功能清单"

---

## 📋 扫描步骤

### Step 1: 识别项目类型

AI 首先判断项目类型：

| 项目类型 | 识别特征 | 扫描重点 |
|---------|---------|---------|
| **前端** | package.json 有 react/vue/next | `pages/`, `components/`, 路由配置 |
| **后端** | package.json 有 express/fastify/nest | `routes/`, `controllers/`, API 定义 |
| **全栈** | 同时有前后端特征 | 分别扫描前后端 |
| **CLI** | bin 字段 | `commands/`, 命令定义 |
| **Python** | requirements.txt / pyproject.toml | `main.py`, `app/`, FastAPI/Flask 路由 |

### Step 2: 执行扫描

AI 应该：

1. **读取目录结构**
   ```
   使用 list_dir 或 find_by_name 获取项目结构
   ```

2. **识别入口文件**
   - 前端：`src/App.js`, `pages/`, `app/`
   - 后端：`index.js`, `app.js`, `routes/`
   - Python：`main.py`, `app.py`

3. **提取功能清单**
   - 路由 → 功能点
   - 组件 → 界面能力
   - API → 服务能力

4. **分类整理**
   按模块/领域分组

### Step 3: 生成 A1 文档

使用以下模板生成：

```markdown
# A1_代码功能快照

> ⚠️ **本文件由 AI 扫描代码自动生成，请勿手动编辑！**
> 
> 最后扫描时间: YYYY-MM-DD HH:mm
> 扫描范围: [项目根目录]

---

## 1. 项目概览

- **项目类型**: [前端/后端/全栈/CLI]
- **技术栈**: [React/Vue/Express/...]
- **入口文件**: [...]

---

## 2. 功能清单

### 2.1 [模块A]

| 功能 | 路径/入口 | 说明 |
|-----|----------|------|
| 功能1 | `src/xxx` | ... |
| 功能2 | `src/yyy` | ... |

### 2.2 [模块B]

...

---

## 3. API 清单 (如有)

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /api/xxx | ... |
| POST | /api/yyy | ... |

---

## 4. 扫描日志

- 扫描了 X 个文件
- 识别了 Y 个功能点
- 识别了 Z 个 API
```

---

## 🔄 更新策略

- **首次扫描**: 生成完整 A1
- **增量更新**: 对比已有 A1，标注 [新增] / [变更] / [删除]
- **冲突处理**: 如果发现代码与 A0 边界冲突，必须报告给 PM

---

## ❌ AI 禁止

1. ❌ 要求用户手动填写 A1
2. ❌ 跳过扫描直接编造功能
3. ❌ 忽略项目中的隐藏文件夹（如 .git）

---

## 💡 最佳实践

- 在每次 `prd plan freeze` 前建议执行一次 A1 扫描
- 将 A1 扫描结果与 A0 边界对比，识别"代码超出规划"的情况
