# R1 规划审视工作流

**重要说明**：本工作流是关于 **R1 规划审视**（在 B1/B2 之后），不是 **R1 启动条件检查**（在 B1/B2 之前）。

- **R1 启动条件检查**：在 `prd iteration new` 时自动创建，用于确认是否允许进入规划阶段（B1/B2 之前）
- **R1 规划审视**：在 `prd review r1` 时创建，用于判断规划是否有资格冻结为 B3（B1/B2 之后）

本工作流用于执行 **R1 规划审视**，判断规划是否有资格冻结为 B3。

---

## 🛡️ 核心准则：PM 判定，AI 执行

1. **判断权在 PM**：AI 扮演审计员（Auditor），PM 扮演决策者（Judge）。
2. **严禁越岗交互**：当 `prd` 命令弹出交互式确认时，**AI 严禁代为确认**。
3. **严禁绕过流程**：AI 绝对禁止通过直接修改文件来绕过 CLI 的拦截器。
4. **对话归档**：必须通过 CLI 命令触发确认，以确保决策被记录在 `98_对话归档`。

---

## 🎯 R1 审视的本质：战略思维导师

AI 必须以"结构化思维导师"的角色进行审视，而不是简单地打分过关。

### 核心思维框架：

```
Step 1: 以终为始 → 确定真正的目标
Step 2: 结构化拆解 → MECE 原则检查完整性
Step 3: 多维决策 → 矩阵分析而非简单打分
```

---

## 🚨 重要：R1 创建前的强制检查

### ⚠️ AI 绝对禁止在以下情况创建 R1

**当 PM 提出"创建 R1"或"执行 R1 审视"时，AI 必须先检查：**

#### 检查清单（AI 必须执行）

```
AI: "在执行 R1 审视之前，我需要检查前置条件：
     
     ✅ 前置条件检查：
     
     第 1 项：是否已创建第一轮迭代？
     检查目录：02_迭代记录/第01轮迭代/
     状态：[✅ 已创建 / ❌ 未创建]
     
     第 2 项：B1_需求规划草案.md 是否存在？
     检查路径：02_迭代记录/第01轮迭代/B1_需求规划草案.md
     状态：[✅ 已创建 / ❌ 未创建]
     
     第 3 项：B2_规划拆解与范围界定.md 是否存在？
     检查路径：02_迭代记录/第01轮迭代/B2_规划拆解与范围界定.md
     状态：[✅ 已创建 / ❌ 未创建]
     
     第 4 项：B1/B2 是否通过对话完成？
     - B1 的核心问题是和 PM 讨论后确定的吗？
     - B2 的需求拆解是和 PM 讨论后确定的吗？
     - 优先级（P0/P1/P2）是 PM 决定的吗？
     状态：[✅ 是 / ❌ 否 / ⚠️ 不确定]
     
     第 5 项：PM 是否明确请求 R1 审视？
     状态：[✅ 明确请求 / ❌ 我没有收到请求]
     
     检查结果：[✅ 全部通过 / ❌ 有未满足项]"
```

#### 前置条件不满足时的处理

**如果任何一项未满足，AI 必须拒绝创建 R1：**

```
AI: "❌ 前置条件检查未通过！
     
     R1 规划审视的前置条件：
     
     必须项：
     - [❌] 第一轮迭代已创建
     - [❌] B1_需求规划草案.md 已创建
     - [❌] B2_规划拆解与范围界定.md 已创建
     - [❌] B1/B2 已通过对话完成（不是 AI 自动填充）
     - [❌] PM 明确请求了 R1 审视
     
     ⚠️ R1 审视不能凭空进行，必须基于 B1/B2 文档。
     
     正确的流程应该是：
     
     1. 创建第一轮迭代：prd iteration new
     2. 创建 B1：prd baseline create B1
     3. 与 AI 对话填写 B1
     4. 创建 B2：prd baseline create B2
     5. 与 AI 对话填写 B2
     6. 请求 R1 审视：prd review r1
     
     ⚠️ 我已拒绝创建 R1，请完成前置步骤后重试。"
```

#### 前置条件满足时的确认流程

**如果所有前置条件都满足：**

```
AI: "✅ 前置条件检查通过！
     
     已确认：
     ✅ 第一轮迭代已创建
     ✅ B1_需求规划草案.md 已创建
     ✅ B2_规划拆解与范围界定.md 已创建
     ✅ B1/B2 已通过对话完成
     ✅ 您明确请求了 R1 审视
     
     现在可以开始 R1 规划审视。
     
     R1 审视将：
     1. 检查目标清晰性（区分手段与目标）
     2. 检查场景真实性（基于现状）
     3. 检查现状一致性（改进 vs 重建）
     4. 检查范围收敛性（MECE 原则）
     5. 检查版本化准备度（CSF 识别）
     
     请执行命令创建 R1 审视报告：
     
     prd review r1
     
     创建后，我将基于 B1/B2 进行系统性审视。"
```

### ⚠️ AI 行为红线（R1 创建）

**AI 在 R1 创建过程中绝对禁止：**

1. ❌ **未检查前置条件就创建 R1**
   - 必须检查迭代、B1、B2 是否存在
   
2. ❌ **B1/B2 不存在还继续创建 R1**
   - 无文档无法审视，必须拒绝
   
3. ❌ **从 R0 直接跳到 R1**
   - 必须先经过：迭代创建 → B1 → B2 → R1
   
4. ❌ **PM 没有明确请求就自动创建 R1**
   - 必须等待 PM 明确指令

**AI 必须做到：**

1. ✅ 主动检查前置条件（迭代/B1/B2）
2. ✅ 向 PM 说明检查结果
3. ✅ 前置条件不满足时，明确拒绝并说明原因
4. ✅ 等待 PM 明确请求
5. ✅ 只建议 PM 执行命令（而非自动执行）

---

## ⚠️ 前置检查：B1/B2 是否通过对话完成？

**在执行 R1 审视之前，AI 必须先自查：**

1. **B1 的填写过程**：
   - [ ] 核心问题是和 PM 讨论后确定的吗？
   - [ ] "不做什么"是 PM 明确说明的吗？
   - [ ] 每个章节都是分段确认后写入的吗？

2. **B2 的填写过程**：
   - [ ] 需求拆解是和 PM 讨论后确定的吗？
   - [ ] 优先级（P0/P1/P2）是 PM 决定的吗？
   - [ ] 首版范围是 PM 决定的吗？
   - [ ] 每个需求项都是逐条确认后写入的吗？

**如果以上任何一项是"否"，说明 AI 越权了！必须：**
1. 停止 R1 审视
2. 告诉 PM："抱歉，我之前越权了。B1/B2 应该和您逐项讨论后填写。"
3. 重新采用对话式协作模式填写 B1/B2

详见工作流：`prd-document-filling.md`

---

## 📋 R1 审视的严格标准

### 维度 1：目标清晰性（以终为始）

**AI 必须拷问：**

1. **区分手段与目标**
   ```
   错误示例："优化 BP 创建流程" ← 这是手段
   正确示例："降低 BP 创建的用户放弃率从 40% 到 10%" ← 这是目标
   
   审视问题：B1 中描述的是"要做什么"还是"要达成什么结果"？
   ```

2. **寻找 Gap（差距）**
   ```
   问题来源于"现实"与"期望"的差距。
   
   审视问题：
   - 当前状态是什么？（引用 A1/A2）
   - 期望状态是什么？（B1 目标）
   - Gap 是否被准确识别？
   ```

3. **时空维度检查**
   ```
   审视问题：
   - 时间：这是短期目标还是长期目标？B1 是否混淆了？
   - 空间：影响的是用户、业务方、还是系统？B1 是否都考虑了？
   ```

**拒绝模糊表述**：
- ❌ "提升用户体验" ← 太模糊
- ✅ "减少用户在 BP 创建时的困惑点，从 5 个降到 2 个以下"

---

### 维度 2：场景真实性（基于现状）

**AI 必须检查：**

1. **是否基于 A 类现状**
   ```
   审视问题：
   - B1 中提到的问题，在 A2 反馈中有体现吗？
   - B1 规划的改进，对应 A1 中的哪个功能？
   - 是否假设了不存在的能力或数据？
   ```

2. **依赖验证**
   ```
   审视问题：
   - B1/B2 依赖的前置条件，在 A0/A1 中是否真实存在？
   - 是否存在"假设系统已经有 XX 能力"的情况？
   ```

**拒绝空中楼阁**：
- ❌ 假设用户会主动学习复杂功能
- ✅ 基于 A2 中"用户反馈不会用"的事实

---

### 维度 3：现状一致性（改进 vs 重建）

**AI 必须区分：**

1. **改进现有能力 vs 新增能力**
   ```
   审视问题：
   - B2 中的需求项，哪些是改进 A1 已有功能？
   - 哪些是完全新增的？
   - 新增的比例是否过高（暗示从零重建）？
   ```

2. **检查"从零重建"倾向**
   ```
   警告信号：
   - 50% 以上的需求项都是"新增"
   - B1 中没有提到任何对 A1 功能的复用
   - B2 中忽略了 A1 的现有流程
   
   审视问题：这是"改进产品"还是"重做产品"？
   ```

---

### 维度 4：范围收敛性（MECE 原则）

**AI 必须用 MECE 原则检查：**

1. **完全穷尽（Collectively Exhaustive）**
   ```
   审视问题：
   - B1 要解决的核心问题，B2 的需求项是否完全覆盖？
   - 是否存在遗漏的场景？
   - 构建决策矩阵：
     
     场景   | B2 需求项覆盖 | 是否遗漏
     ------|------------|--------
     场景1  | REQ-001    | ✅
     场景2  | 无         | ❌ 遗漏！
   ```

2. **相互独立（Mutually Exclusive）**
   ```
   审视问题：
   - B2 的需求项之间是否有重复/交叉？
   - 优先级排序是否合理（CSF 识别）？
   ```

3. **明确"不做什么"**
   ```
   审视问题：
   - B1 是否明确列出了"不做的内容"？
   - B2 是否有需求项超出了 B1 的范围？
   
   警告信号：
   - B1 说"不做审批流程"，但 B2 里出现了"审批需求"
   ```

4. **范围膨胀风险**
   ```
   审视问题：
   - 需求项数量是否过多（>15 项可能失控）？
   - 首版包含是否克制（建议 ≤50% 需求项进首版）？
   ```

---

### 维度 5：版本化准备度（CSF 识别）

**AI 必须识别关键成功因素：**

1. **识别 20% 的 CSF**
   ```
   审视问题：
   - B2 中哪 20% 的需求决定了 80% 的效果？
   - 这些 CSF 是否被标记为 P0？
   - 如果 CSF 被标为 P1/P2，这是错误的优先级排序
   ```

2. **不再讨论"值不值得做"**
   ```
   审视问题：
   - B1/B2 是否还在犹豫"要不要做这个"？
   - 如果还在纠结，说明规划未成熟
   ```

3. **可版本化检查**
   ```
   审视问题：
   - B2 的需求项能否拆分为多个版本？
   - 首版、二版的边界是否清晰？
   ```

---

## 🔍 审视执行方法：矩阵分析

**AI 必须构建评估矩阵，而不是简单打分：**

### 示例：目标清晰性矩阵

| 检查项 | 期望标准 | B1 实际情况 | 符合度 | 问题 |
|-------|---------|-----------|-------|-----|
| 描述的是结果而非手段 | ✅ | ⚠️ 部分是手段 | 60% | "优化流程"需改为具体指标 |
| Gap 已识别 | ✅ | ✅ 引用了 A2 | 100% | 无 |
| 时间维度明确 | ✅ | ❌ 未区分短/长期 | 0% | 需补充时间规划 |

**总体评估**：目标清晰性 = 53%，**不通过**

---

## 💬 苏格拉底式审视对话

**AI 不应该直接给结论，而是通过提问引导 PM 反思：**

```
AI: "我注意到 B1 中写的是'优化 BP 创建流程'。
     
     请问，这是手段还是目标？
     
     真正想达成的结果是什么？是提升创建成功率？还是降低创建时间？"

PM: [回答]

AI: "理解了。那么当前的成功率/时间是多少？（现实状态）
     期望达到多少？（期望状态）
     这个 Gap 在 A2 反馈中有体现吗？"

PM: [回答]

AI: "好的。建议将 B1 的目标改写为：
     '将 BP 创建成功率从 60% 提升至 90%'
     
     这样更清晰。您同意吗？"
```

---

## 📊 最终决策矩阵

**AI 必须输出多维评估矩阵：**

| 维度 | 权重 | 评分 | 加权分 | 关键问题 |
|-----|-----|-----|-------|---------|
| 目标清晰性 | 30% | 53% | 15.9 | 目标是手段 |
| 场景真实性 | 20% | 80% | 16.0 | 基本符合 |
| 现状一致性 | 15% | 90% | 13.5 | 无问题 |
| 范围收敛性 | 25% | 40% | 10.0 | 未明确"不做" |
| 版本化准备度 | 10% | 70% | 7.0 | CSF 未识别 |
| **总分** | 100% | - | **62.4** | **不通过（≥80% 才通过）** |

**结论**：
- [ ] ✅ 通过
- [ ] ⚠️ 有条件通过（需补齐：XX、YY）
- [x] ❌ 不通过（需重新规划）

**不通过原因**：
1. 目标表述为手段而非结果
2. 未明确"不做什么"
3. CSF 未识别

**改进建议**：
1. 将 B1 目标改写为可衡量的结果
2. 在 B1 中增加"明确不做"部分
3. 在 B2 中识别并标记 CSF

---

## ⚠️ AI 行为红线

### AI 绝对禁止：

1. ❌ 简单打分然后说"通过" ← 太水了
2. ❌ 说"基本符合，可以冻结" ← 没有严格审查
3. ❌ 只看 B1/B2 而不对照 A 类 ← 脱离现状
4. ❌ 不构建矩阵直接给结论 ← 缺乏逻辑
5. ❌ 发现问题不拷问 PM ← 放弃引导职责

### AI 必须做到：

1. ✅ 用苏格拉底式提问引导 PM 反思
2. ✅ 构建评估矩阵并展示推理过程
3. ✅ 严格对照 A 类文档进行一致性检查
4. ✅ 用 MECE 原则检查完整性
5. ✅ 识别 CSF 并检查优先级排序

---

**本工作流将 AI 从"打分机器"变为"战略思维导师"，确保只有真正成熟的规划才能通过！**
- PM 运行: `prd review r1`
- **AI 行为**: 观察控制台。当 CLI 询问 "确认 B1、B2 已由 PM 填写完成" 时，AI 必须停下，请 PM 确认。

### 2. 执行审计
- **前提**: PM 已在终端完成确认。
- **AI 行为**: 
  - 读取 A0, A1, A2, B1, B2。
  - 按照 CLI 输出的 "5个维度" 进行深度分析。
  - 在 `R1_规划审视报告.md` 中填写审计意见。
  - **提示**: 只指出现状不符、目标膨胀、场景断点等风险。

### 3. 最终判定
- **AI 行为**: 给出审计结论（通过/有条件通过/不通过）。
- **PM 行为**: 在 `R1_规划审视报告.md` 签字并决定是否冻结。

### 4. 冻结归档 (B3)
- PM 运行: `prd plan freeze`
- **AI 行为**: 严禁代签。必须等待 PM 在终端手动输入名字并由 PM 执行确认。

---

## 📝 审计提示

- 指出 B1 是否偏离了 A0 确定的范围。
- 检查 B2 是否引入了未在 B1 讨论过的功能。
- 确认 B2 的 P0 优先级需求是否能支撑核心闭环。
