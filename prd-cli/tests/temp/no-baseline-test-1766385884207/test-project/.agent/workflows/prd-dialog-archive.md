# PRD 对话归档工作流

**核心原则**：所有对话必须可追溯！

---

## 🛡️ 归档规则

### AI 必须在以下时机记录对话：

1. **每次 PM 确认决策时**
2. **每次讨论需求项时**
3. **每次确定优先级时**
4. **每次界定范围时**
5. **每次 AI 给出建议时**

---

## 📝 需要记录的内容

### 1. 对话轮次记录

每轮对话都应记录：
- **讨论主题**: 在讨论什么
- **PM 说的话**: PM 的原话或要点
- **AI 的回复**: AI 的总结或建议
- **PM 的决策**: PM 最终的决定
- **背景信息**: 相关上下文

### 2. 需求讨论记录

讨论需求项时应记录：
- 需求项编号
- PM 描述的需求内容
- AI 的理解和总结
- PM 是否确认

### 3. 优先级决策记录

确定优先级时应记录：
- P0/P1/P2 各包含哪些需求
- PM 的决策理由
- 最终确认的排序

### 4. 范围决策记录

界定范围时应记录：
- 首版包含哪些
- 延后哪些
- PM 的决策理由

---

## 🔧 归档方法

### 方法 1：通过 Node.js 直接调用

AI 可以在项目目录下创建一个临时脚本来记录对话：

```javascript
// 在项目目录下执行
const dialog = require('./prd-cli/commands/dialog');

// 记录一轮对话
dialog.logConversationRound(
    'planning',                           // 阶段
    '讨论核心问题',                        // 主题
    'BP创建流程用户体验差',                // PM 说的
    '理解，要解决的核心问题是用户体验',    // AI 回复
    'PM 确认这是核心问题',                 // PM 决策
    '来自用户反馈会议'                     // 背景
);

// 记录需求讨论
dialog.logRequirementDiscussion(
    'planning',
    'REQ-001',
    '需要进度指示器',
    '理解：添加进度条显示当前步骤',
    true  // 确认
);

// 记录优先级决策
dialog.logPriorityDecision(
    'planning',
    { P0: ['REQ-001', 'REQ-002'], P1: ['REQ-003'], P2: ['REQ-004'] },
    '流程引导是核心体验，必须先做'
);

// 记录范围决策
dialog.logScopeDecision(
    'planning',
    ['REQ-001', 'REQ-002', 'REQ-003'],  // 首版包含
    ['REQ-004', 'REQ-005'],              // 延后
    '时间有限，先保证核心闭环'
);
```

### 方法 2：直接写入对话记录文件

AI 也可以直接在 `98_对话归档/` 目录下追加内容到 markdown 文件：

```markdown
## 2025/12/18 22:00:00

**阶段**: planning
**动作**: conversation_round
**迭代轮次**: 1

### 💬 对话内容

**讨论主题**: 讨论核心问题

**🧑 PM**: BP创建流程太复杂了，用户反馈不知道到哪一步了

**🤖 AI**: 理解，您描述的核心问题是"创建流程缺乏清晰的进度指示"。这个问题在 A2 用户反馈中有体现吗？

**✅ PM 决策**: 是的，确认核心问题是流程引导不足

**📋 背景**: 来自交付会议的用户反馈

---
```

---

## ✅ 归档效果示例

好的对话归档应该像这样：

```markdown
# 对话记录

**文件**: planning_对话记录.md
**记录数**: 5

---

## 2025/12/18 19:03:54

**阶段**: planning
**动作**: conversation_round

### 💬 对话内容

**讨论主题**: 确认核心问题

**🧑 PM**: 用户反馈说创建BP的时候不知道到哪一步了，也不知道该填什么

**🤖 AI**: 理解。您描述的问题可以总结为"创建流程缺乏清晰指引"。这包括：
1. 进度不可见
2. 填写指引缺失
3. 操作反馈不足
对吗？

**✅ PM 决策**: 对，就是这三个问题

---

## 2025/12/18 19:10:30

**阶段**: planning
**动作**: requirement_discussion

### 💬 对话内容

**讨论主题**: 需求项 REQ-001 讨论

**🧑 PM**: 需要一个进度条，让用户知道当前在哪一步

**🤖 AI**: 好的，需求项 #1：创建进度指示器，显示当前步骤和总步骤。是这个意思吗？

**✅ PM 决策**: 确认

---

## 2025/12/18 19:20:00

**阶段**: planning
**动作**: priority_decision

### 💬 对话内容

**讨论主题**: 优先级排序决策

**🧑 PM**: 进度指示器和保存确认必须做，操作日志可以后面做

**🤖 AI**: 已记录优先级：P0=2项, P1=1项, P2=1项

**✅ PM 决策**: {"P0":["REQ-001","REQ-002"],"P1":["REQ-003"],"P2":["REQ-004"]}

---
```

---

## ⚠️ AI 行为约束

### AI 必须：

1. **及时记录** - 每轮对话结束后立即记录
2. **完整记录** - 包含 PM 的原话、AI 的回复、最终决策
3. **准确记录** - 不能歪曲 PM 的意思
4. **主动记录** - 不需要 PM 提醒

### AI 禁止：

- ❌ 只记录结论，不记录过程
- ❌ 讨论完忘记归档
- ❌ 合并多轮对话为一条记录
- ❌ 省略 PM 的关键决策

---

**本工作流确保所有对话过程可追溯！**
