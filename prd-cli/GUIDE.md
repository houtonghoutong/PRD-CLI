# PRD Workflow CLI - 使用指南

## 目录
- [快速上手](#快速上手)
- [完整工作流示例](#完整工作流示例)
- [与 AI 协作](#与-ai-协作)
- [常见问题](#常见问题)

## 快速上手

### 第一次使用

```bash
# 1. 安装
npm install -g prd-workflow-cli

# 2. 初始化项目
prd init my-product
cd my-product

# 3. 查看项目结构
tree -L 2
```

你会看到:
```
my-product/
├── 00_项目总览/
│   └── P0_项目基本信息.md
├── 01_产品基线/
├── 02_迭代记录/
├── 99_归档区/
├── .agent/workflows/
└── README.md
```

## 完整工作流示例

### 阶段一: 建立基线(首次必做)

```bash
# 1. 创建 A0 - 产品基础与范围说明
prd baseline create A0
```

打开 `01_产品基线/A0_产品基础与范围说明.md`,填写:
- 产品是什么
- 目标用户
- 核心场景
- **重点**: 当前不支持什么

```bash
# 2. 创建 A1 - 已上线功能清单
prd baseline create A1
```

列出所有**已存在**的功能和用户路径,不要写"期望有的"。

```bash
# 3. 创建 A2 - 存量反馈汇总
prd baseline create A2
```

整理用户反馈、数据异常、已知问题。

```bash
# 4. 创建 R0 - 基线审视
prd baseline create R0
```

从头到尾走一遍系统,确认基线稳定。

✅ **基线完成后,可以开始第一轮迭代**

### 阶段二: 启动迭代(每轮必做)

```bash
# 开始新迭代
prd iteration new
```

这会在 `02_迭代记录/第01轮迭代/` 下创建 `R1_规划启动条件检查.md`。

**重要**: 填写并确认三个条件:

1. ✅ 问题真实存在
   - 在 A1 中能找到对应的功能或路径断点
   - 或在 A2 中有用户反馈/数据支撑

2. ✅ 值得单独规划
   - 不是"顺手改一下"
   - 会显著影响核心路径

3. ✅ 问题已理解清楚
   - 知道是哪个用户
   - 知道在哪个场景
   - 边界清晰

⚠️ **如果任何一条不满足,不要继续!**

### 阶段三: 需求规划(B 阶段)

```bash
# 1. 创建 B1 - 规划草案
prd plan create B1
```

在 `B1_需求规划草案.md` 中描述:
- 规划目标(一句话)
- 使用场景(基于 A 类现状)
- 核心需求
- **重点**: 明确不做什么

```bash
# 2. 创建 B2 - 规划拆解
prd plan create B2
```

在 `B2_规划拆解与范围界定.md` 中:
- 拆解需求项
- 排优先级
- 划边界

```bash
# 3. 冻结规划（自动执行 R1 审视）
prd plan freeze
```

⚠️ **简化流程**: freeze 命令会自动执行:
1. 前置检查（文档完整性）
2. R1 审视（5 维度）
3. 通过后生成 `B3_规划冻结归档.md`

如果检查不通过，会显示具体问题，需要修改后重试。

可选: 手动执行 R1 审视 `prd review r1`（用于提前了解问题）

### 阶段四: 版本需求(C 阶段)

```bash
# 1. 创建 C1 - 版本需求清单（已包含版本范围声明）
prd version create C1
```

📋 **新版 C1 已合并 C0**，无需单独创建 C0。

在 `C1_版本需求清单.md` 中填写:
- **第 1 章**: 版本范围声明（版本目标、包含、不包含）
- **第 2 章**: 详细需求清单（来源、描述、验收标准）

```bash
# 2. 冻结版本（自动执行 R2 审视）
prd version freeze
```

⚠️ **简化流程**: freeze 命令会自动执行:
1. 前置检查（C1 完整性）
2. R2 审视（5 维度）
3. 通过后生成 `C3_版本冻结归档.md`

如果检查不通过，会显示具体问题，需要修改后重试。

🎉 **C3 生成后，产品需求阶段完成！**

## 与 AI 协作

### 场景一: R1 审视

```
我已经完成了 B1、B2 文档。

请你扮演【产品规划审视官】,按照以下 5 个维度审视:
1. 目标清晰性
2. 场景真实性
3. 现状一致性
4. 范围收敛性
5. 版本化准备度

请参考:
- 01_产品基线/ 下的 A 类文档
- 当前迭代的 B1、B2 文档
- .agent/workflows/prd-r1-review.md 中的详细指令

请在 R1_规划审视报告.md 中填写审视结果,
并给出明确的通过/不通过结论。
```

### 场景二: R2 审视

```
请你扮演【版本一致性审视官】,检查:
C0、C1 是否忠实执行了 B3 的规划。

审视维度:
1. 版本目标一致性
2. 版本范围偏移检查
3. 规划覆盖完整性
4. 需求粒度成熟度
5. 进入执行准备度

参考 .agent/workflows/prd-r2-review.md 中的详细指令,
在 R2_版本审视报告.md 中填写结果。
```

### 场景三: 规划协作

```
我想为产品添加一个新功能。

先帮我检查 R1 启动条件:
1. 这个问题是否在 A1/A2 中有依据?
2. 是否值得单独规划?
3. 问题边界是否清楚?

然后我们一起完成 B1 规划草案。
```

## 常见问题

### Q1: 必须严格按顺序吗?

**A**: 是的。简化后的流程只有 6 步:
```
1. prd init           → 创建项目
2. prd plan create B1 → 写规划草案
3. prd plan create B2 → 写需求拆解
4. prd plan freeze    → 冻结规划（自动 R1 审视）
5. prd version create C1 → 写需求清单（含版本范围）
6. prd version freeze → 冻结版本（自动 R2 审视）
```

⚠️ freeze 命令会自动执行审视检查，不通过则阻断。

### Q2: prd plan freeze 不通过怎么办?

**A**: freeze 命令会告诉你具体哪些检查没通过:

1. **文档检查失败**: B1/B2 不存在或内容为空
   - 解决: 填写 B1/B2 必填项

2. **R1 审视不通过**: 5 个维度有问题
   - 解决: 根据提示修改 B1/B2，然后重试

3. **紧急情况**: 使用 `prd plan freeze --force` 跳过检查（不推荐）

### Q3: 基线文档一定要做吗?

**A**: 第一轮迭代前必须做,后续迭代可以:
- 直接使用(如果产品稳定)
- 更新(如果有重大变化)

**不做基线的风险**:
- AI 会假设不存在的能力
- 规划会"从零重建"
- 失去现状约束

### Q4: 可以同时进行多个迭代吗?

**A**: 每个项目同时只能有一个活跃迭代。

原因:
- 每个迭代都需要审视
- 并行会导致冲突和混乱

如果有多个需求:
- 在 B2 中全部列出
- 排优先级
- 分批进入版本

### Q5: B3 冻结后还能改吗?

**A**: 不建议,除非:
- 外部约束变化(如合规要求)
- 发现重大风险

修改流程:
1. 说明变更原因
2. 更新 B3
3. 重新执行 R1 审视
4. 如果已进入 C 阶段,需要同步更新

### Q6: 与传统 PRD 的区别?

**A**: 

| 传统 PRD | 本工具 |
|----------|--------|
| 一次写完 | 分阶段,有闸门 |
| 想到哪写到哪 | 强制基于现状(A 类) |
| 需求容易膨胀 | R1/R2 审视控制 |
| 规划和版本混在一起 | B/C 严格分离 |
| 人工审查 | AI 可执行审视 |

### Q7: 适合什么规模的项目?

**A**: 

- ✅ **适合**: 需要多轮迭代的产品
- ✅ **适合**: 团队需要规范约束
- ✅ **适合**: 与 AI 协作开发
- ⚠️ **可选**: 一次性项目
- ⚠️ **可选**: 原型验证阶段

## 下一步

1. 📖 阅读 [文档结构说明](/原始资料素材/2、产品输出文档结构.md)
2. 🔍 理解 [R1 启动条件](/原始资料素材/5、R1进入B1的条件.md)
3. 🤖 学习 [R1、R2 审视指令](/原始资料素材/7、R1、R2审视指令.md)
4. 📊 查看 [B3 与 C 的边界](/原始资料素材/8、B3 与 C0 、 C1 的边界定义.md)

---

**记住**: 这个工具的核心价值不是"写更多文档",而是"防止写错误的文档"。
