# PRD Workflow CLI - 快速使用指南

> 本指南帮助你快速上手 PRD-CLI 工具

---

## 目录

- [核心概念](#核心概念)
- [完整工作流](#完整工作流)
- [与 AI 协作](#与-ai-协作)
- [常见问题](#常见问题)

---

## 核心概念

### 术语表

| 术语 | 全称 | 说明 |
|------|------|------|
| **IT** | INVEST User Story | 符合 INVEST 原则的用户故事 |
| **BIZ** | Business Specification | 业务需求规格（给业务方看） |
| **DEV** | Development Specification | 技术规格说明（给开发看） |
| **R1** | Review 1 | 规划审视（B 阶段结束时） |
| **R2** | Review 2 | 版本审视（IT 完成后） |
| **PM** | Product Manager | 产品经理 |

### 什么是 INVEST？

IT 代表 INVEST 用户故事，必须满足：

- **I**ndependent（独立的）- 每个 IT 可独立交付
- **N**egotiable（可协商的）- 细节可讨论
- **V**aluable（有价值的）- 对用户有明确价值
- **E**stimable（可估算的）- 开发可评估工作量
- **S**mall（小的）- 可在一个迭代内完成
- **T**estable（可测试的）- 有明确验收标准

### 流程总览

```
A 阶段（基线）→ B 阶段（规划）→ IT 阶段（用户故事）→ C 阶段（版本冻结）
     ↑               ↑                   ↑                    ↑
   AI 生成       PM+AI 对话          PM+AI 对话            AI 自动生成
```

---

## 完整工作流

### 阶段一：建立基线（首次必做）

```bash
# 1. 初始化项目
prd init my-product
cd my-product
```

#### A0 - 产品定义（PM 手动填写）

打开 `01_产品基线/A0_产品基础与范围说明.md`，填写：

- 产品是什么
- 目标用户
- 核心场景
- **重点**: 当前不支持什么

#### A1 - 代码功能快照（AI 自动生成）

```
💡 使用 /prd-a1-scan 让 AI 自动扫描代码生成
```

> ⚠️ A1 禁止手动维护！由 AI 根据代码自动生成。

---

### 阶段二：需求规划（B 阶段）

```bash
# 1. 开始新迭代
prd iteration new

# 2. 创建规划文档
prd plan create B
```

#### B 规划文档结构

`B_规划文档.md` 包含以下部分（由 PM 与 AI 对话完成）：

| 章节 | 内容 | 填写方式 |
|------|------|---------|
| 1. 启动检查 | 问题真实？值得做？边界清？ | PM 确认 ✅ |
| 2. 核心问题 | 要解决什么、期望结果、不做什么 | PM 回答 AI 提问 |
| 3. 需求拆解 | 需求列表、优先级、首版范围 | PM 决策 |
| 4. PM 确认 | 签名确认 | PM 签字 |

```bash
# 3. 冻结规划（自动执行 R1 审视）
prd plan freeze
```

✅ `freeze` 命令会自动：
1. 检查文档完整性
2. 执行 R1 审视
3. 通过后生成 `B3_规划冻结归档.md`

---

### 阶段三：IT 用户故事

v1.5.0 引入 INVEST 原则的 **IT 用户故事**，严格区分 BIZ 与 DEV。

```bash
# 1. 创建 IT（自动生成 BIZ + DEV 两个文件）
prd it create "批量导出功能"
```

生成：
```
IT/IT-001-批量导出功能/
├── IT-001-BIZ.md   # 业务需求
└── IT-001-DEV.md   # 技术规格
```

#### IT-BIZ（业务需求）

| ✅ 只写 | ❌ 不写 |
|---------|---------|
| 用户是谁 | API 接口 |
| 做什么 | 数据库设计 |
| 价值 | 按钮位置 |
| 验收标准 (AC) | 技术实现细节 |

```
💡 使用 /prd-it-biz 工作流让 AI 引导你填写
```

#### IT-DEV（技术规格）

| ✅ AI 会做 | ❌ AI 不会做 |
|------------|-------------|
| 生成模板 | 编造 API |
| 分析影响范围 | 编造 SQL |
| 记录技术问答 | 编造算法细节 |

```
💡 技术细节需要通过对话询问技术负责人，AI 只记录答案
```

---

### 阶段四：版本冻结（C 阶段）

```bash
# 冻结版本（自动执行 R2 审视）
prd version freeze
```

✅ `freeze` 命令会自动：
1. 执行 R2 审视（检查 IT 是否忠实于 B3）
2. 汇总所有 IT 文档
3. 生成 `C3_版本冻结归档.md`
4. PM 只需签名确认

---

## 与 AI 协作

### 场景一：IT-BIZ 编写

```
用户: 我想写"批量导出"的业务需求

AI: 好的，请告诉我：
    1. 谁使用这个功能？
    2. 在什么场景下使用？
    3. 期望达到什么效果？

用户: 运营人员...

AI: (根据回答生成 IT-xxx-BIZ.md)
```

### 场景二：IT-DEV 填充

```
用户: 现在写 DEV 文档

AI: 好的，已生成模板。请技术负责人确认：
    1. 涉及哪些 API 变更？
    2. 需要修改哪些数据表？
    3. 异常情况如何处理？

用户: 需要新增一个 /api/export 接口...

AI: (记录回答，不编造细节)
```

### 场景三：A2UI 可视化

```
用户: 这个页面顶部有个搜索栏，下面是列表

AI: 收到，我为您生成界面原型图...
    (自动生成并提示刷新预览)
```

---

## 常见问题

### Q1: 为什么废弃了 B1/B2？

**A**: 为了简化流程。v1.5.0 将规划、拆解、审视整合到一个 `B_规划文档` 中，减少文件切换。

### Q2: 为什么一定要分 BIZ 和 DEV？

**A**: 
- **BIZ** 是给老板、业务方看的，承诺"做什么"
- **DEV** 是给开发看的，指导"怎么做"
- 混合在一起会导致逻辑混乱，且容易让 AI 产生幻觉

### Q3: AI 为什么不帮我写 SQL 了？

**A**: v1.5.0 增加了严格的防幻觉限制。AI 不了解你的私有数据库结构，编造 SQL 只会误导开发。AI 的角色转变为"引导者"和"记录员"。

### Q4: 必须每个 IT 都写吗？

**A**: 是的。每个独立的功能点（User Story）都应该由 BIZ + DEV 组成。微小改动可以合并，但必须保持结构。

### Q5: C0 和 C1 去哪了？

**A**: 已废弃。C0/C1 的功能被 IT 用户故事替代。C3 由 `prd version freeze` 自动生成。

---

## 下一步

1. 📖 阅读 [README.md](./README.md) 了解完整功能
2. 🤖 体验 `/prd-a1-scan`、`/prd-it-biz`、`/prd-it-dev` 工作流
3. 📝 查看 [CHANGELOG.md](./CHANGELOG.md) 了解版本历史

---

**记住**: 这个工具的核心价值不是"写更多文档"，而是"防止写错误的文档"。
