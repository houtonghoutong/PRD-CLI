# B1/B2/C1 文档填写流程修复报告

**修复时间**: 2025-12-19  
**版本**: 1.1.3 → 1.1.4（待发布）  
**修复类型**: 文档填写流程控制强化

---

## 📌 问题描述

### 用户反馈

用户执行 `prd plan create B1` 命令后，AI 直接输出了完整的 B1 规划内容，包括：
- 本轮迭代目标
- 本轮包含的需求（5个需求项，P0/P1 已标注）
- 本轮不包含
- 初步工作量评估
- 请确认

**问题**：PM 没有提供任何版本规划信息之前，AI 就填充了完整的 B1 内容。

### 问题截图分析

从用户截图可以看到：
1. 用户执行了 `prd plan create B1`
2. CLI 创建了 B1_需求规划草案.md 文件
3. AI 直接填充了完整的 B1 内容，包括：
   - 本轮迭代目标：完善内审部分...
   - 需求清单：5个需求项，已标注优先级
   - 本轮不包含：AI 自动建议、商业业务闭环...
   - 工作量评估：前端/后端时间

**严重违规**：AI 在 PM 未提供任何信息的情况下，自己"规划"了整个迭代！

---

## 🔍 问题根源

### 1. CLI 代码实现是正确的

查看 `planning.js` 代码：
```javascript
function getB1Template() {
    return `# B1_需求规划草案

**创建时间**: ${new Date().toLocaleString('zh-CN')}
**文档状态**: 草案

---

## 1. 规划目标

### 1.1 核心问题

**要解决的核心问题**:
<!-- 填写内容：描述具体要解决的问题，必须可在 A1/A2 中找到依据 -->
...
```

CLI 创建的是**空模板**（带注释的框架），这是正确的。

### 2. 工作流文档有引导流程，但缺少强制检查

查看 `prd-document-filling.md`：
- ✅ 有明确的 B1 填写流程
- ✅ 有"以终为始"、"Gap 分析"等步骤
- ✅ 有分段写入的要求

**但是**：
- ❌ **缺少文档创建时的强制启动检查**
- ❌ **没有明确禁止 AI 在未对话前填充内容**
- ❌ **没有检测机制：当 B1 被创建时，AI 应该做什么**

### 3. AI 的错误行为

AI 看到 B1 文档被创建后，可能：
1. 直接假设用户的意图
2. 基于上下文推测需求
3. 自己填充了完整内容

**违反核心原则**：PM 决策，AI 执行

---

## 🔧 修复方案

### 核心修复：增加文档创建时的强制启动检查

在 `prd-document-filling.md` 中为 B1、B2、C1 添加强制启动检查机制。

---

## ✅ 修复内容

### 1. B1 填写流程修复

**位置**：`prd-document-filling.md` - B1 填写流程开头

**新增内容**：

#### 强制启动检查

```markdown
### 🚨 B1 创建时的强制启动检查

**⚠️ AI 绝对禁止在未与 PM 对话的情况下填充 B1 内容！**

当检测到 B1 文档被创建时，AI 必须执行以下流程：

AI: "✅ B1_需求规划草案.md 已创建。

     在填写 B1 之前，我需要通过对话引导你思考和确认。
     
     🚨 重要原则：
     - AI 不得在 PM 未提供信息之前填充内容
     - AI 必须通过提问引导 PM 思考
     - 每个部分都要分段确认后才写入
     
     第一个问题：你期望这个规划达成什么结果？（End Game）
     
     请用一句话描述，并且这个结果必须是可衡量的。"
```

#### AI 行为红线

**AI 绝对禁止：**
1. ❌ 未经对话就填充完整内容
2. ❌ 假设或推测 PM 的意图
3. ❌ 一次性填充多个章节
4. ❌ 替 PM 决策

**AI 必须做到：**
1. ✅ 检测到 B1 创建后，立即开始对话引导
2. ✅ 通过提问引导 PM 思考
3. ✅ 分段确认后才写入
4. ✅ 让 PM 做所有决策

#### 正确示例

```
用户: "创建 B1"
AI: [执行命令创建 B1]

AI: "✅ B1 已创建。
     
     第一个问题：你期望这个规划达成什么结果？"

用户: "我想提升内审流程的效率"

AI: "'提升效率'是手段。真正要达成的结果是什么？
     - 是缩短内审时间？
     - 是提高通过率？
     - 是减少返工次数？"

用户: "缩短内审时间，从平均 14 天缩短到 10 天"

AI: "明白了。核心目标是：
     '将内审流程时间从平均 14 天缩短到 10 天'
     
     这个 Gap 在 A2 用户反馈中有体现吗？"

用户: "有的，A2 中用户反馈审批太慢"

AI: "好的。现在我把这部分写入 B1 的'规划目标'章节。
     
     [执行写入]
     
     已写入。请检查是否准确。
     
     接下来，让我们明确'不做什么'..."
```

---

### 2. B2 填写流程修复

**位置**：`prd-document-filling.md` - B2 填写流程开头

**新增内容**：

#### 强制启动检查

```markdown
### 🚨 B2 创建时的强制启动检查

**⚠️ AI 绝对禁止在未与 PM 对话的情况下填充 B2 内容！**

当检测到 B2 文档被创建时，AI 必须：

AI: "✅ B2_规划拆解与范围界定.md 已创建。

     在填写 B2 之前，我需要通过对话引导你拆解需求。
     
     🚨 重要原则：
     - AI 不得假设或推测需求项
     - AI 必须让 PM 决定每个需求的优先级
     - AI 必须让 PM 决定首版范围
     
     第一个问题：要达成 B1 的目标，需要哪几个维度的能力？"
```

#### AI 行为红线

**AI 绝对禁止：**
1. ❌ 未经对话就列出需求项
2. ❌ 替 PM 决定优先级（P0/P1/P2）
3. ❌ 替 PM 决定首版范围
4. ❌ 不用 MECE 原则检查

**AI 必须做到：**
1. ✅ 引导 PM 用 MECE 原则拆解
2. ✅ 让 PM 决定优先级
3. ✅ 让 PM 决定首版范围
4. ✅ 构建决策矩阵辅助决策

---

### 3. C1 填写流程修复

**位置**：`prd-document-filling.md` - C1 填写流程开头

**新增内容**：

#### 强制启动检查

```markdown
### 🚨 C1 创建时的强制启动检查

**⚠️ AI 绝对禁止在未与 PM 对话的情况下填充 C1 内容！**

当检测到 C1 文档被创建时，AI 必须：

AI: "✅ C1_版本需求清单.md 已创建。

     在填写 C1 之前，我需要确认并细化每个需求。
     
     🚨 重要原则：
     - C1 只能包含 B3 冻结的首版范围
     - AI 必须逐项询问需求细节
     - 禁止省略细节或边界情况
     
     首先，让我确认 B3 首版包含的需求项...
     
     [读取 B3 首版范围]
     
     确认 C1 将基于这些需求展开，不会新增。对吗？"
```

#### AI 行为红线

**AI 绝对禁止：**
1. ❌ 未经对话就填充需求细节
2. ❌ 省略或简化需求细节
3. ❌ 新增 B3 范围外的需求
4. ❌ 不记录 PM 的特殊说明

**AI 必须做到：**
1. ✅ 严格检查 C1 与 B3 的映射关系
2. ✅ 逐项询问需求的 8 个维度
3. ✅ 完整记录所有细节
4. ✅ 分段确认后才写入

---

## 📊 修复效果对比

### 修复前（错误）

```
用户: "创建 B1"

CLI: [创建 B1_需求规划草案.md]

AI: "我已经帮你规划了本轮迭代：
     
     目标：完善内审部分，加速业务闭环
     
     需求：
     1. 内审会管理 (P0)
     2. 内审评估流程 (P0)
     3. 投资决策确认 (P0)
     4. 档案进展前扩展 (P1)
     5. 工作台报办扩展 (P1)
     
     本轮不包含：
     - AI 自动建议（单02轮）
     - 商业业务闭环（下一期投资需活页）
     
     工作量：前端 14-21 人天，后端 9-15 人天
     
     请确认。"

← 错误！AI 自己"规划"了整个迭代！
```

### 修复后（正确）

```
用户: "创建 B1"

CLI: [创建 B1_需求规划草案.md]

AI: "✅ B1_需求规划草案.md 已创建。
     
     在填写 B1 之前，让我通过提问引导你思考。
     
     第一个问题：你期望这个规划达成什么结果？
     
     请用一句话描述，这个结果必须是可衡量的。"

用户: "我想完善内审流程，加速业务闭环"

AI: "'完善内审流程'和'加速业务闭环'都是手段。
     
     真正要达成的结果是什么？
     - 是缩短内审时间？从多少天降到多少天？
     - 是提高内审通过率？从多少提升到多少？
     - 还是其他可衡量的指标？"

用户: "缩短内审流程时间，从平均 14 天降到 10 天"

AI: "明白了。核心目标是：
     '将内审流程时间从平均 14 天缩短到 10 天'
     
     这个 Gap 在 A2 用户反馈中有体现吗？"

← 正确！通过对话引导 PM 思考，而不是自己假设
```

---

## 📈 关键改进点

| 改进项 | 修复前 | 修复后 |
|--------|--------|--------|
| 文档创建检测 | 无强制检查 | 有强制启动检查 |
| AI 行为约束 | 隐式要求 | 明确禁止清单 |
| PM 参与度 | AI 可能自己填充 | 必须通过对话引导 |
| 决策权归属 | AI 可能替 PM 决策 | PM 做所有决策 |
| 内容质量 | 可能是 AI 假设 | 基于 PM 真实意图 |

---

## 🚀 后续优化建议

### 短期（本次修复已包含）

1. ✅ 为 B1/B2/C1 添加强制启动检查
2. ✅ 明确 AI 行为红线
3. ✅ 提供正确/错误示例

### 中期（可考虑）

1. **增加文档内容检测**
   - 检测文档是否已填充内容
   - 如果是 AI 自动生成的，提醒 PM 清空重新开始

2. **增加对话状态追踪**
   - 记录 AI 是否已经与 PM 对话
   - 如果未对话就填充内容，触发告警

3. **统一所有文档的创建行为**
   - A0/A1/A2 也需要类似的启动检查
   - 确保所有文档都是对话式填写

### 长期（可探索）

1. **AI 行为监控**
   - 记录 AI 是否遵守工作流
   - 生成合规性报告
   - 识别并告警违规行为

2. **交互式填写模式**
   - 提供引导式问答界面
   - 自动保存对话历史
   - 支持回溯和修改

---

## 📝 总结

本次修复通过在文档填写工作流中增加**强制启动检查**，确保：

1. **AI 不会自动填充内容**：必须通过对话引导
2. **PM 始终是决策者**：所有决策都由 PM 做出
3. **分段确认写入**：每个部分都要确认后才写入
4. **明确行为红线**：禁止 AI 越权行为

### 核心价值

- **流程规范化**：明确的启动检查流程
- **职责明确化**：PM 决策，AI 执行
- **质量保证**：基于 PM 真实意图，而非 AI 假设
- **可追溯性**：通过对话记录决策过程

---

**修复完成时间**: 2025-12-19  
**修复人员**: AI Assistant  
**待发布版本**: 1.1.4
