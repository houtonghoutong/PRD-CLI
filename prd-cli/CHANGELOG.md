# 变更日志 (CHANGELOG)

## [2.0.0] - 2026-02-09

### 🚀 重大更新 - 中文命名体系 & 流程简化

本版本对命名体系进行了全面重构，采用直观的中文命名，去除混乱的编号系统。

### 💥 破坏性变更

#### 文档命名变更

| 旧名称 | 新名称 |
|--------|--------|
| `P0_项目基本信息.md` | `项目信息.md` |
| `A0_产品基础与范围说明.md` | `产品定义.md` |
| `A1_已上线功能与流程清单.md` | `代码快照.md` |
| `A2_存量反馈与数据汇总.md` | `用户反馈.md` |
| `B_规划文档.md` | `需求规划.md` |
| `B3_规划冻结归档.md` | `规划冻结.md` |
| `IT-xxx-BIZ.md` | `业务需求.md` |
| `IT-xxx-DEV.md` | `技术规格.md` |
| `C3_版本冻结归档.md` | `版本发布.md` |

#### 目录结构变更

| 旧目录 | 新目录 |
|--------|--------|
| `01_产品基线/` | `01_基线/` |

#### 删除的概念

- **R0/R1/R2** - "审视"作为动作内化到 `freeze` 命令中，不再是独立文档

### ✨ 新增

- **中文参数支持**：`prd baseline create 产品定义/代码快照/用户反馈`
- **简化命令**：`prd plan create` 无需参数
- **向后兼容**：旧参数（A0/A1/A2/B）仍可使用

### 🔄 变更

#### 命令变更

| 旧命令 | 新命令 |
|--------|--------|
| `prd baseline create A0` | `prd baseline create 产品定义` |
| `prd baseline create A1` | `prd baseline create 代码快照` |
| `prd baseline create A2` | `prd baseline create 用户反馈` |
| `prd baseline create R0` | **删除** |
| `prd plan create B` | `prd plan create` |
| `prd review r1/r2` | **删除**（内化到 freeze） |

#### 核心流程简化

```
旧流程: A → R → B → C
新流程: 基线 → 规划 → IT → 版本
```

### 📝 更新的术语

| 术语 | 含义 |
|------|------|
| **IT** | INVEST User Story（保留） |
| **基线** | 产品现状基线（原 A 类） |
| **规划** | 需求规划（原 B 类） |
| **版本** | 版本发布（原 C 类） |

### 🧪 测试

- 所有单元测试已更新适配新命名
- 快照测试已重新生成
- 向后兼容性测试通过

---

## [1.5.0] - 2026-01-22

### 🚀 重大更新 - IT 架构升级 & 文档流程简化

本版本对 PRD-CLI 进行了全面重构，大幅简化文档维护流程，引入 IT (INVEST) 用户故事结构。

### ✨ 新增

#### 1. IT (INVEST) 用户故事结构
- **双文档模式**：每个需求包含 `IT-xxx-BIZ.md`（业务规格）和 `IT-xxx-DEV.md`（开发规格）
- **BIZ 文档**：用户故事、验收标准（AC-xxx）、业务规则（BR-xxx）
- **DEV 文档**：影响范围、开发要点、待确认问题
- **新增命令**：`prd it create "需求名称"` 创建 IT 用户故事
- **新增工作流**：`/prd-it-biz`、`/prd-it-dev`

#### 2. A 类文档简化（Code-First）
- **A1 自动生成**：新增 `/prd-a1-scan` 工作流，AI 扫描代码生成 `A1_代码功能快照.md`
- **P0 模板精简**：聚焦"业务宪法"（产品定位、边界、职责、成功标准）

#### 3. B 阶段简化
- **文档合并**：将 B1、B2、R1 合并为单一 `B_规划文档.md`
- **新增命令**：`prd plan create B` 创建简化的规划文档
- **新增工作流**：`/prd-b-planning`
- **R1 内化**：启动条件检查集成到 B 文档中

### 🔄 变更

#### 文档结构变更
| 旧结构 | 新结构 |
|-------|-------|
| B1 + B2 + R1 | `B_规划文档.md` |
| C0 + C1 | `IT-xxx-BIZ.md` + `IT-xxx-DEV.md` |
| 11个文档 | **6个核心文档** |

#### 命令变更
- `prd plan create B1/B2` → **已废弃**，使用 `prd plan create B`
- `prd version create C0/C1` → **已废弃**，使用 `prd it create`

#### AI 规则变更
- **新增红线**：禁止编造技术细节（API/SQL/算法）
- **DEV 文档定位**：开发要点提示，具体 RT 拆解由技术负责人决定
- **职责边界**：AI 提供方向建议，不做具体 RT 拆解

### 🗑️ 删除

- `.agent/workflows/prd-c1-requirement-list.md`
- `.agent/workflows/prd-b1-planning-draft.md`
- `.agent/workflows/prd-b2-planning-breakdown.md`
- `.agent/workflows/prd-r1-review.md`

### 🔧 优化

- `prd status` 更新显示新的文档结构
- `prd upgrade` 自动清理废弃工作流文件
- `prd iteration new` 简化提示，不再创建 R1 启动检查文档
- `commands/freeze-checks.js` 检查 `B_规划文档.md`

### 📝 文档

- 更新 `.cursorrules`、`.antigravity/rules.md` 适配新架构
- 更新 `rules/index.json` scope 映射
- 更新 README.md 反映新工作流

### 核心价值

- ✅ **文档减少 45%**：从 11 个减少到 6 个核心文档
- ✅ **AI 不越界**：明确 AI 只提供方向，不编造技术细节
- ✅ **Code-First**：A1 由 AI 从代码生成，减少手动维护
- ✅ **简化规划**：B 阶段一次对话完成，无需多轮文档

---


## [1.1.25] - 2025-12-25

### ✨ 新增 - 自动更新 + upgrade 升级命令

**解决问题**：用户在项目内安装 prd-workflow-cli 后，卸载重装新版本，但项目中的 workflows 文件和 AI 规则文件不会自动更新

### 新增功能

1. **自动更新（postinstall）**
   - 安装包后自动检测是否在 PRD 项目中
   - 自动更新 workflows 和 AI 规则文件到最新版本
   - 用户无需手动操作，卸载重装即可更新所有配置文件
   - 非 PRD 项目（如全局安装）静默跳过

2. **`prd upgrade` 手动命令**
   - 支持手动触发更新（作为备选方案）
   - 支持 `--dry-run` 预览模式
   - 支持 `--force` 强制更新
   - 支持 `-v, --verbose` 详细信息

### 使用方式

```bash
# 方式一：自动更新（推荐）
npm uninstall prd-workflow-cli
npm install prd-workflow-cli
# 安装完成后会自动更新项目中的配置文件

# 方式二：手动更新
prd upgrade              # 执行更新
prd upgrade --dry-run    # 预览将要更新的文件
```

### 核心价值

- ✅ **零操作升级**：卸载重装自动更新，用户无感知
- ✅ **版本同步**：确保配置文件与 CLI 版本一致
- ✅ **安全可靠**：只更新有变化的文件，失败不影响安装

---

## [1.1.9] - 2025-12-22

### 🔧 修复 - R0 创建添加 PM 确认机制

**解决问题**：R0 可以在没有 PM 确认的情况下被创建，违反工作流规范

### 修复内容

1. **R0 创建前置条件检查**
   - ✅ 检查 P0 是否存在
   - ✅ 检查 A0 是否存在
   - ✅ 检查 A1 是否存在
   - ✅ A2 为可选项

2. **增加 PM 确认机制**
   - ✅ 创建 R0 时需要 PM 交互式确认
   - ✅ 支持 `--pm-confirmed` 选项（AI 对话中使用）
   - ✅ 确认对话记录到归档
   - ✅ 测试模式支持

3. **增强提示信息**
   - ✅ R0 完成后明确提醒不要自动创建后续文档
   - ✅ 必须由 PM 明确指示才能进入下一阶段

### 使用方式

```bash
# 正常创建（交互式确认）
prd baseline create R0

# AI 对话中使用（PM 已确认）
prd baseline create R0 --pm-confirmed
```

---

## [1.1.8] - 2025-12-22

### 🔧 修复 - R0-R1 流程跳跃问题（严重）

**解决问题**：AI 在完成 R0 基线审视后，直接创建并通过 R1 审视，跳过了整个规划阶段

### 问题表现

在 1.1.7 版本中发现：
- ❌ AI 在 R0 完成后直接创建 R1
- ❌ 跳过了迭代创建步骤
- ❌ 跳过了 B1/B2 规划文档创建
- ❌ 凭空进行 R1 审视（没有基础文档）

### 修复内容

1. **强化 R0 工作流结束边界**
   - ✅ 明确禁止 R0 完成后自动创建任何后续文档
   - ✅ 禁止在 R0 阶段提及 "R1"
   - ✅ 明确 R0 完成后 AI 职责结束
   - ✅ 详细列出 PM 需要执行的完整步骤序列

2. **增加 R1 工作流前置检查**
   - ✅ 必须检查第一轮迭代是否已创建
   - ✅ 必须检查 B1_需求规划草案.md 是否存在
   - ✅ 必须检查 B2_规划拆解与范围界定.md 是否存在
   - ✅ 必须检查 B1/B2 是否通过对话完成
   - ✅ 必须检查 PM 是否明确请求 R1 审视
   - ✅ 任何一项不满足，AI 必须拒绝创建 R1

3. **更新 .cursorrules 规则**
   - ✅ 增加详细的前置条件说明
   - ✅ 明确禁止流程跳跃行为
   - ✅ 定义每个阶段的结束点

### 正确流程

```
R0 完成 
  ↓ [AI 停止，等待 PM 决策]
  ↓
创建第一轮迭代 (prd iteration new)
  ↓
创建 B1 (prd baseline create B1)
  ↓ [AI 通过对话引导填写]
  ↓
创建 B2 (prd baseline create B2)
  ↓ [AI 通过对话引导填写]
  ↓
请求 R1 审视 (prd review r1)
  ↓ [AI 检查前置条件]
  ↓
执行 R1 审视
```

### AI 行为红线（新增）

**R0 完成后，AI 绝对禁止：**
1. ❌ 自动创建第一轮迭代
2. ❌ 自动创建 B1/B2
3. ❌ 自动执行 R1 审视
4. ❌ 主动提及 "R1"
5. ❌ 说 "我现在帮你进入下一阶段"

**R1 创建前，AI 绝对禁止：**
1. ❌ 未检查前置条件就创建 R1
2. ❌ B1/B2 不存在还继续创建 R1
3. ❌ 从 R0 直接跳到 R1
4. ❌ PM 没有明确请求就自动创建 R1

### 📝 文档

- 新增《R0-R1 流程跳跃问题分析与修复方案》
- 更新 R0 基线审视工作流（强化结束边界）
- 更新 R1 规划审视工作流（增加前置检查）
- 更新 .cursorrules（增加流程跳跃禁止规则）

### 核心价值

- ✅ **流程完整性**：确保不跳过任何必要步骤
- ✅ **PM 控制权**：AI 不会自动推进流程
- ✅ **文档依赖性**：R1 审视必须基于 B1/B2 文档
- ✅ **决策透明性**：每个阶段都需要 PM 明确决定

---

## [1.1.7] - 2025-12-19

### ✨ 新增 - AI 规则文件配置

**解决问题**：AI 在不同 IDE（Cursor、Antigravity、Claude 等）中经常"忘记"工作流规则

- **创建 IDE 专用规则文件**
  - 新增 `.cursorrules` - Cursor IDE 自动读取
  - 新增 `.antigravity/rules.md` - Antigravity (Gemini) 专用
  - 新增 `AI-GUIDE.md` - 所有 IDE 通用指引

- **规则文件内容**
  - 核心原则：PM 决策，AI 执行
  - 5 大禁止行为（未经对话填充、替 PM 决策、假设意图等）
  - 5 大必须行为（检查前置、提问引导、分段确认、战略分析、归档对话）
  - 具体场景的正确反应示例
  - 归档要求和自我检查清单

### 🔧 优化

- **项目初始化增强**
  - `prd init` 时自动复制 `.cursorrules` 到新项目
  - `prd init` 时自动复制 `.antigravity/` 到新项目
  - `prd init` 时自动复制 `AI-GUIDE.md` 到新项目
  - 新项目开箱即用，AI 自动遵守规则

### 📝 文档

- 新增《AI 规则文件配置说明》
- 说明不同 IDE 的规则文件路径
- 提供规则文件使用指南

### 核心价值

- ✅ **规则持久化**：AI 不会"忘记"工作流规则
- ✅ **跨 IDE 一致性**：Cursor、Antigravity 等都遵守相同规则
- ✅ **自动加载**：不同 IDE 自动读取对应的规则文件
- ✅ **新项目即用**：`prd init` 时自动包含所有规则

---

## [1.1.6] - 2025-12-19

### ✨ 新增 - 对话归档机制完善

- **创建归档模板**
  - 新增 `templates/dialog-template.md` 标准归档模板
  - 提供统一的 Markdown 格式规范

- **工作流增加归档要求**
  - B1 工作流增加 Step 5：归档对话（每完成一个部分立即归档）
  - B2 工作流增加 Step 6：归档对话（每完成一轮分析立即归档）
  - C1 工作流增加 Step 6：归档对话（每完成一个需求立即归档）

- **项目初始化自动复制模板**
  - `prd init` 时自动复制归档模板到 `98_对话归档/`
  - 新项目开箱即用

### 🔧 优化

- **AI 行为检查清单增强**
  - 增加归档检查项（每完成一个部分都要归档）
  - 增加归档承诺（5 项明确承诺）
  - 增加归档位置规范
  - 增加归档检查清单

### 📝 文档

- 新增《对话归档机制修复方案》
- 新增《对话归档机制修复完成报告》
- 新增《对话归档机制修复最终总结》
- 新增《所有工作流归档要求增加完成报告》

### 核心价值

- ✅ **对话可追溯**：PM 和 AI 在 IDE 中的对话都被完整记录
- ✅ **决策有依据**：PM 的决策过程和理由都有记录
- ✅ **过程可重现**：后续可以查看当时的讨论详情
- ✅ **质量有保证**：AI 的战略分析过程被完整保留

---

## [1.1.4] - 2025-12-19

### 🔧 修复
- **修复 B1/B2/C1 文档填写流程控制问题**
  - 禁止 AI 在未与 PM 对话的情况下填充文档内容
  - AI 必须通过对话引导 PM 提供信息
  - AI 必须分段确认后才写入
  - 禁止 AI 替 PM 做决策（如优先级、范围等）

### ✨ 新增
- **B1 创建时的强制启动检查**
  - 检测到 B1 创建后，AI 必须开始对话引导
  - 明确 AI 行为红线（禁止自动填充、假设意图等）
  - 提供正确/错误示例

- **B2 创建时的强制启动检查**
  - AI 必须引导 PM 用 MECE 原则拆解需求
  - AI 必须让 PM 决定优先级和首版范围
  
- **C1 创建时的强制启动检查**
  - AI 必须逐项询问需求的 8 个维度
  - AI 必须完整记录所有细节

### 📝 文档
- 新增《B1/B2/C1 文档填写流程修复报告》
- 更新文档填写工作流，增加强制启动检查

---

## [1.1.3] - 2025-12-19

### 🔧 修复
- **修复 R0 创建流程控制问题**
  - 增加 R0 创建前的强制检查机制
  - AI 必须检查 P0、A0、A1 是否完成后才能创建 R0
  - AI 必须与 PM 确认后才能建议执行创建命令
  - 禁止 AI 自动执行 `prd baseline create R0` 命令

### ✨ 新增
- 增加 R0 创建前的前置条件检查流程
- 增加 R0 创建时的 PM 确认流程
- 明确定义 AI 在 R0 创建过程中的行为红线

### 📝 文档
- 新增《R0 创建流程修复报告》，详细说明问题和解决方案
- 更新 R0 基线审视工作流文档

---

## [1.1.2] - 2025-12-19

### ✨ 新增
- 新增 P0 项目基本信息填写工作流文档 (`prd-p0-project-info.md`)
- 新增 P0 填写的详细引导和 AI 对话示例

### 🔧 优化
- **优化项目初始化提示**：增加明确的分步指引，强调先完善 P0 再创建 A0
  - 第 1 步：进入项目目录
  - 第 2 步：完善 P0_项目基本信息.md（⚠️ 必填）
  - 第 3 步：创建 A0 基线文档
  
- **更新文档填写工作流**：在 `prd-document-filling.md` 开头增加 P0 前置要求说明
  - 明确 P0 必须在 B/C 类文档之前完成
  - 提供 AI 检测 P0 未完成时的提醒模板

### 📝 文档
- 新增《P0 填写流程修复报告》，详细说明问题和解决方案

### 🐛 修复
- 修复用户初始化项目后跳过 P0 直接创建 A0 的问题
- 修复工作流文档中缺少 P0 填写指引的问题

---

## [1.1.1] - 2025-12-18

### ✨ 新增
- 完整的 C2 变更追踪机制
- P1 迭代索引自动生成功能
- R0 基线审视的 AI 主动审查模式
- PM 确认机制优化

### 🔧 优化
- Git 提交行为改进：需要显式确认
- 对话归档流程优化

---

## [1.1.0] - 2025-12-17

### ✨ 新增
- 完整的 A→R→B→C 工作流
- 基线管理功能
- 迭代管理功能
- 审视机制（R0/R1/R2）
- 对话归档功能

### 📝 文档
- 完整的工作流文档
- GUIDE.md 使用指南
- README.md 项目说明

---

## 版本说明

- **主版本号（1.x.x）**：重大功能变更或不兼容更新
- **次版本号（x.1.x）**：新功能添加，向后兼容
- **修订版本号（x.x.2）**：Bug 修复和小优化
