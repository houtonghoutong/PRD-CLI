# PRD-CLI 工具介绍

> 本文档是对《产品经理 AI 规范》的工具实现补充，详细说明 PRD-CLI 的功能、流程和使用方法。

---

## 一、工具定位

PRD-CLI 是《产品经理 AI 规范》的**工程化实现**。它不是一个独立的流程管理系统，而是：

> **一套嵌入 AI 编程助手的工作流规范引擎**

通过 CLI 命令 + 规则文件 + 工作流指引的组合，确保 AI 在产品工作中：
- 遵循阶段化结构
- 尊重 PM 决策权
- 不越权执行

---

## 二、核心工作流：A → R → B → C

PRD-CLI 采用**四阶段工作流**，对应《产品经理 AI 规范》的阶段化结构：

```
┌────────────────────────────────────────────────────────────┐
│                    A 阶段（基线建立）                        │
│   A0 产品基础与范围 → A1 已上线功能清单 → A2 存量反馈汇总     │
│                           ↓                                 │
│                    R0 基线审视报告                           │
└────────────────────────────────────────────────────────────┘
                            ↓ R0 通过后
┌────────────────────────────────────────────────────────────┐
│                    B 阶段（规划设计）                        │
│   创建迭代 → R1启动检查 → B1 需求规划草案 → B2 规划拆解      │
│                           ↓                                 │
│              R1 规划审视 → B3 规划冻结归档                   │
└────────────────────────────────────────────────────────────┘
                            ↓ B3 冻结后
┌────────────────────────────────────────────────────────────┐
│                    C 阶段（版本细化）                        │
│   C0 首版概述 → C1 版本需求清单 → C2 变更跟踪               │
│                           ↓                                 │
│              R2 版本审视 → C3 版本冻结归档                   │
└────────────────────────────────────────────────────────────┘
```

### 阶段说明

| 阶段 | 目的 | 核心文档 |
|------|------|----------|
| **A 阶段** | 建立基线，搞清楚现状 | A0、A1、A2 |
| **R0** | 审视基线是否完整可靠 | R0 基线审视报告 |
| **B 阶段** | 规划设计，明确要做什么 | B1、B2、B3 |
| **R1** | 审视规划是否成熟可行 | R1 规划审视报告 |
| **C 阶段** | 版本细化，明确怎么做 | C0、C1、C2、C3 |
| **R2** | 审视版本是否可交付 | R2 版本审视报告 |

---

## 三、核心机制

### 3.1 冻结点机制

每个阶段的结束都有**冻结点**，一旦冻结：
- 不允许修改已冻结的文档
- 新需求只能暂存到 A2，等待下一轮迭代

这对应规范中的"阶段边界处收敛"原则。

| 冻结点 | 触发命令 | 效果 |
|--------|----------|------|
| B3 冻结 | `prd plan freeze` | B1、B2 不可再修改 |
| C3 冻结 | `prd version freeze` | C0、C1 不可再修改 |

### 3.2 R1 双阶段检查

R1 分为两个阶段，防止 AI 跳过必要的审视：

| 阶段 | 时机 | 检查内容 |
|------|------|----------|
| **R1 启动检查** | 创建迭代后 | 问题是否真实存在？是否值得单独规划？边界是否清楚？ |
| **R1 规划审视** | B1/B2 后 | 目标清晰性、场景真实性、现状一致性、范围收敛性、版本化准备度 |

**R1 启动检查的三个条件**：
1. 问题是否被确认真实存在（基于 A 类文档）
2. 问题是否需要"单独一轮规划"来解决
3. 问题是否已理解到"可规划"的程度

### 3.3 AI 行为红线

通过 `.cursorrules` 文件植入 AI 编程助手，确保 AI 遵循规则：

```
1. ❌ 禁止未经对话就填充文档 → 必须通过提问引导 PM 填写
2. ❌ 禁止替 PM 做决策 → 优先级、范围、目标都由 PM 决定
3. ❌ 禁止"快速完成"跳过流程 → 每个阶段都要充分对话和审视
4. ❌ 禁止修改已冻结的文档 → B3/C3 冻结后不能改
5. ❌ 禁止在 C1 阶段加入新需求 → 新需求只能暂存到 A2
6. ❌ 禁止跳过审视 → B2 后必须 R1，C1 后必须 R2
7. ❌ 禁止 R1 直接输出"通过" → 必须有 5 维度分析和评估矩阵
8. ❌ 禁止创建迭代后直接创建 B1 → 必须先引导 PM 填写 R1 启动检查
```

---

## 四、CLI 命令一览

### 项目管理

| 命令 | 功能 |
|------|------|
| `prd init .` | 在当前目录初始化 PRD 项目 |
| `prd init <项目名>` | 创建新项目目录并初始化 |
| `prd status` | 查看当前项目状态 |

### 基线管理（A 阶段）

| 命令 | 功能 |
|------|------|
| `prd baseline create A0` | 创建 A0 产品基础与范围说明 |
| `prd baseline create A1` | 创建 A1 已上线功能与流程清单 |
| `prd baseline create A2` | 创建 A2 存量反馈与数据汇总 |

### 迭代管理（B 阶段）

| 命令 | 功能 |
|------|------|
| `prd iteration new` | 创建新一轮迭代（含 R1 启动检查） |
| `prd iteration list` | 列出所有迭代 |
| `prd plan create B1` | 创建 B1 需求规划草案 |
| `prd plan create B2` | 创建 B2 规划拆解与范围界定 |
| `prd plan freeze` | 冻结规划（生成 B3） |

### 版本管理（C 阶段）

| 命令 | 功能 |
|------|------|
| `prd version create C0` | 创建 C0 首版概述 |
| `prd version create C1` | 创建 C1 版本需求清单 |
| `prd version freeze` | 冻结版本（生成 C3） |

### 审视管理

| 命令 | 功能 |
|------|------|
| `prd review r0` | 执行 R0 基线审视 |
| `prd review r1` | 执行 R1 规划审视 |
| `prd review r2` | 执行 R2 版本审视 |

---

## 五、项目目录结构

```
项目名/
├── .prd-config.json      # 项目配置文件
├── .agent/workflows/     # AI 工作流指引（9 个）
├── .cursorrules          # Cursor AI 规则
├── .antigravity/         # Antigravity AI 规则
│
├── 00_项目总览/
│   └── P0_项目基本信息.md
│
├── 01_产品基线/          # A 类文档
│   ├── A0_产品基础与范围说明.md
│   ├── A1_已上线功能与流程清单.md
│   ├── A2_存量反馈与数据汇总.md
│   └── R0_基线审视报告.md
│
├── 02_迭代记录/          # B/C 类文档（按迭代组织）
│   ├── 第01轮迭代/
│   │   ├── R1_规划启动条件检查.md
│   │   ├── B1_需求规划草案.md
│   │   ├── B2_规划拆解与范围界定.md
│   │   ├── R1_规划审视报告.md
│   │   ├── B3_规划冻结归档.md
│   │   ├── C0_首版概述.md
│   │   ├── C1_版本需求清单.md
│   │   ├── C2_变更跟踪.md
│   │   ├── R2_版本审视报告.md
│   │   └── C3_版本冻结归档.md
│   └── 第02轮迭代/
│       └── ...
│
├── 98_对话归档/          # PM 确认记录
└── 99_归档区/            # 历史文档
    └── 历史参考与废弃文档/
```

---

## 六、与规范的对应关系

| 规范内容 | 工具实现 |
|----------|----------|
| 阶段化工作结构 | A → R → B → C 四阶段流程 |
| 阶段边界处收敛 | `prd plan freeze` / `prd version freeze` 冻结点 |
| PM 决策权 | CLI 确认机制 + AI 红线规则 |
| AI 角色边界 | `.cursorrules` 行为规则 |
| 多轮迭代追溯 | `02_迭代记录/` 按轮次归档 |
| 变更记录 | `C2_变更跟踪.md` |
| 需求澄清阶段 | A 阶段 + R0 审视 |
| 方案推演阶段 | B1、B2 |
| 方案确认阶段 | R1 审视 + B3 冻结 |
| 推进与迭代阶段 | C 阶段 + 后续迭代 |

---

## 七、安装与使用

### 快速开始

```bash
# 创建项目目录
mkdir my-project && cd my-project

# 安装 CLI
npm init -y
npm install prd-workflow-cli

# 在当前目录初始化
npx prd init .
```

### 完整流程示例

```bash
# 1. 初始化项目
npx prd init .

# 2. 填写 P0 项目基本信息
# （手动编辑 00_项目总览/P0_项目基本信息.md）

# 3. 创建基线文档
npx prd baseline create A0
npx prd baseline create A1
npx prd baseline create A2

# 4. 执行基线审视
npx prd review r0

# 5. 创建第一轮迭代
npx prd iteration new

# 6. 填写 R1 启动检查并创建规划文档
npx prd plan create B1
npx prd plan create B2

# 7. 执行规划审视并冻结
npx prd review r1
npx prd plan freeze

# 8. 创建版本文档
npx prd version create C0
npx prd version create C1

# 9. 执行版本审视并冻结
npx prd review r2
npx prd version freeze
```

---

## 八、当前版本

**prd-workflow-cli@1.1.30**

### 主要特性

- ✅ 支持 `prd init .` 在当前目录初始化
- ✅ 自动安装时复制工作流和规则文件
- ✅ R1 双阶段检查机制
- ✅ 8 条 AI 行为红线规则
- ✅ 冻结点机制防止越权修改
- ✅ 对话归档确保决策可追溯

### 更新方法

```bash
npm uninstall prd-workflow-cli
npm install prd-workflow-cli
```

---

## 九、相关文档

- 《产品经理 AI 规范｜项目立项说明与背景》：规范的理论基础
- `.agent/workflows/` 目录：各阶段的详细工作流指引
- `.cursorrules`：AI 行为规则完整版
