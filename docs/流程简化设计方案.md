# PRD-CLI 流程简化设计方案

> 📅 设计日期：2024-12-30
> 
> 🎯 目标：将 12 步流程简化为 6 步，降低 PM 和 AI 的执行负担

---

## 目录

1. [问题分析](#1-问题分析)
2. [简化原则](#2-简化原则)
3. [新旧流程对比](#3-新旧流程对比)
4. [详细设计](#4-详细设计)
5. [实现计划](#5-实现计划)
6. [风险评估](#6-风险评估)

---

## 1. 问题分析

### 1.1 当前流程的痛点

| 痛点 | 说明 |
|------|------|
| **步骤过多** | 完整流程 12+ 步，记忆负担重 |
| **双重遗漏风险** | AI 不可靠，PM 也容易遗漏 |
| **审视分散** | R0/R1/R2 作为独立步骤，容易被跳过 |
| **文档冗余** | A0/A1/A2 分开，增加管理成本 |

### 1.2 核心洞察

> **不要让 AI 或 PM 记住规则，而是让程序在关键节点强制执行。**

关键节点只有两个：
1. **规划冻结前**（B3）
2. **版本冻结前**（C3）

---

## 2. 简化原则

### 2.1 合并原则

| 原则 | 说明 |
|------|------|
| **同阶段合并** | 同一阶段的多个文档合并为一个 |
| **审视前置** | 审视合并到冻结命令中，自动执行 |
| **入口统一** | 每个阶段只有一个入口命令 |

### 2.2 保留原则

| 原则 | 说明 |
|------|------|
| **质量守卫** | 保留 R1/R2 的核心检查逻辑，但合并到 freeze |
| **冻结机制** | 保留 B3/C3 冻结概念，但简化触发方式 |
| **可追溯性** | 所有决策和审视都有记录 |

---

## 3. 新旧流程对比

### 3.1 现状流程（12 步）

```
A 阶段（4 步）
  A0 产品基础与范围说明
  ↓
  A1 已上线功能与流程清单
  ↓
  A2 存量反馈与数据汇总
  ↓
  R0 基线审视

B 阶段（5 步）
  创建迭代
  ↓
  B1 需求规划草案
  ↓
  B2 规划拆解与范围界定
  ↓
  R1 规划审视
  ↓
  B3 规划冻结

C 阶段（4 步）
  C0 版本范围声明
  ↓
  C1 版本需求清单
  ↓
  R2 版本审视
  ↓
  C3 版本冻结
```

### 3.2 简化后流程（6 步）

```
┌───────────────────────────────────────────────┐
│  A0 项目基线（合并 A0+A1+A2+R0）               │
│  包含：项目信息、现状分析、用户反馈、基线审视  │
└───────────────────────────────────────────────┘
                      ↓
┌───────────────────────────────────────────────┐
│  B1 规划草案                                   │
│  包含：规划目标、Gap分析、不做什么             │
└───────────────────────────────────────────────┘
                      ↓
┌───────────────────────────────────────────────┐
│  B2 需求拆解                                   │
│  包含：需求清单、优先级、开发批次              │
└───────────────────────────────────────────────┘
                      ↓
┌───────────────────────────────────────────────┐
│  prd plan freeze                              │
│  自动执行：R1 审视 + B3 冻结                   │
│  ⚠️ 不通过则阻断                              │
└───────────────────────────────────────────────┘
                      ↓
┌───────────────────────────────────────────────┐
│  C1 需求清单（合并 C0+C1）                     │
│  包含：版本范围、详细需求、验收标准            │
└───────────────────────────────────────────────┘
                      ↓
┌───────────────────────────────────────────────┐
│  prd version freeze                           │
│  自动执行：R2 审视 + C3 冻结                   │
│  ⚠️ 不通过则阻断                              │
└───────────────────────────────────────────────┘
```

### 3.3 对比总结

| 维度 | 现状 | 简化后 | 变化 |
|------|------|--------|------|
| 总步骤数 | 12 | 6 | -50% |
| 文档数量 | 10 | 4 | -60% |
| 需要记忆的命令 | 10+ | 6 | -40% |
| 强制检查点 | 0（依赖 AI/PM） | 2（程序强制） | ✅ |

---

## 4. 详细设计

### 4.1 A0 项目基线（合并文档）

**命令**：`prd init`（已有，扩展）

**包含内容**：

```markdown
# 项目基线文档

## 1. 项目基本信息（原 P0）
- 项目名称
- 项目描述
- 核心目标

## 2. 产品现状（原 A0+A1）
- 产品范围
- 已上线功能清单
- 技术架构概述

## 3. 用户反馈汇总（原 A2）
- 用户痛点
- 数据指标
- 待解决问题

## 4. 基线审视（原 R0）
- 信息完整性检查
- 问题优先级评估
- 是否可以开始规划
```

**触发时机**：项目初始化时创建，后续可更新

---

### 4.2 B1 规划草案

**命令**：`prd plan create B1`（保留）

**包含内容**：

```markdown
# B1 需求规划草案

## 1. 规划目标
- 期望结果（End Game）
- 可衡量指标
- 时间范围

## 2. Gap 分析
- 当前状态
- 期望状态
- 差距原因

## 3. 明确不做什么
- 本轮不包含的内容
- 排除理由
```

---

### 4.3 B2 需求拆解

**命令**：`prd plan create B2`（保留）

**包含内容**：

```markdown
# B2 规划拆解与范围界定

## 1. 需求清单
| ID | 需求名称 | 优先级 | 描述 |
|----|---------|--------|------|
| #1 | ... | P0 | ... |

## 2. 优先级排序
- P0：必须做
- P1：应该做
- P2：可以做

## 3. 开发批次
- 第 1 批：#1, #2, #3
- 第 2 批：#4, #5
- ...
```

---

### 4.4 prd plan freeze（核心改造）

**命令**：`prd plan freeze`（改造）

**新行为**：

```javascript
async function planFreeze() {
  console.log('📋 B3 规划冻结前置检查...\n');
  
  // 1. 检查文档存在性
  const docChecks = [
    checkDocExists('B1_需求规划草案.md'),
    checkDocExists('B2_规划拆解.md'),
  ];
  
  // 2. 检查必填项
  const contentChecks = [
    checkFieldFilled('B1', '规划目标'),
    checkFieldFilled('B1', '不做什么'),
    checkFieldFilled('B2', '需求清单'),
    checkFieldFilled('B2', '优先级排序'),
  ];
  
  // 3. 执行 R1 审视（5 维度）
  const r1Checks = [
    checkGoalClarity(),      // 目标清晰性
    checkScenarioReality(),  // 场景真实性
    checkStatusConsistency(), // 现状一致性
    checkScopeConvergence(), // 范围收敛性
    checkVersionReadiness(), // 版本化准备度
  ];
  
  // 4. 汇总结果
  const allChecks = [...docChecks, ...contentChecks, ...r1Checks];
  const failures = allChecks.filter(c => !c.pass);
  
  if (failures.length > 0) {
    console.log('❌ 无法冻结，以下检查未通过：\n');
    failures.forEach(f => console.log(`  ⚠️ ${f.message}`));
    console.log('\n请先解决以上问题，然后重新运行 prd plan freeze');
    return;
  }
  
  // 5. 通过，执行冻结
  console.log('✅ 所有检查通过！');
  createFreezeDoc('B3');
  console.log('📦 B3_规划冻结归档.md 已生成');
}
```

**输出示例（检查通过）**：

```
📋 B3 规划冻结前置检查...

✅ B1_需求规划草案.md 存在
✅ B2_规划拆解.md 存在
✅ 规划目标已填写
✅ "不做什么"已明确
✅ 需求清单已有 5 项
✅ 优先级已排序

📊 R1 审视结果：
✅ 目标清晰性：目标可衡量
✅ 场景真实性：关联到 A0 用户反馈
✅ 现状一致性：与现状匹配
✅ 范围收敛性：边界明确
✅ 版本化准备度：可拆分为批次

✅ 所有检查通过！
📦 B3_规划冻结归档.md 已生成
```

**输出示例（检查失败）**：

```
📋 B3 规划冻结前置检查...

✅ B1_需求规划草案.md 存在
✅ B2_规划拆解.md 存在
✅ 规划目标已填写
⚠️ "不做什么"部分为空 → 请在 B1 中补充
✅ 需求清单已有 5 项
⚠️ 优先级未排序 → 请在 B2 中标注 P0/P1/P2

📊 R1 审视结果：
✅ 目标清晰性：目标可衡量
⚠️ 场景真实性：未关联到 A0 用户反馈 → 请说明数据来源
✅ 现状一致性：与现状匹配
⚠️ 范围收敛性：边界模糊 → 需求 #3 描述过于宽泛
✅ 版本化准备度：可拆分为批次

❌ 无法冻结，以下检查未通过：

  ⚠️ "不做什么"部分为空
  ⚠️ 优先级未排序
  ⚠️ 场景真实性：未关联到用户反馈
  ⚠️ 范围收敛性：需求 #3 描述过于宽泛

请先解决以上问题，然后重新运行 prd plan freeze
```

---

### 4.5 C1 需求清单（合并 C0+C1）

**命令**：`prd version create C1`（合并 C0）

**包含内容**：

```markdown
# C1 版本需求清单

## 1. 版本范围声明（原 C0）
- 版本号：v1.0
- 本版本包含：第 1 批需求（#1, #2, #3）
- 本版本不包含：第 2、3 批

## 2. 详细需求（原 C1）

### REQ-001 需求名称
- **背景**：用户痛点
- **描述**：详细功能描述
- **验收标准**：
  - [ ] 条件 1
  - [ ] 条件 2
- **边界情况**：异常处理

### REQ-002 ...
```

---

### 4.6 prd version freeze（核心改造）

**命令**：`prd version freeze`（改造）

**新行为**：类似 plan freeze，执行 R2 审视 + C3 冻结

---

## 5. 实现计划

### 5.1 Phase 1：改造 freeze 命令（优先级 P0）

| 任务 | 工作量 | 说明 |
|------|-------|------|
| 改造 `prd plan freeze` | 2 天 | 添加前置检查逻辑 |
| 改造 `prd version freeze` | 2 天 | 添加前置检查逻辑 |
| 编写检查函数 | 1 天 | 文档存在、必填项、R1/R2 审视 |
| 测试 | 1 天 | 各种场景测试 |

**产出**：freeze 命令自动执行检查和审视

### 5.2 Phase 2：合并文档模板（优先级 P1）

| 任务 | 工作量 | 说明 |
|------|-------|------|
| 设计新模板 | 1 天 | A0 合并、C1 合并 |
| 更新 init 命令 | 0.5 天 | 创建合并后的 A0 |
| 更新 version create | 0.5 天 | C1 包含 C0 内容 |
| 更新 workflow 文件 | 1 天 | 对应简化后的流程 |

**产出**：简化后的文档结构

### 5.3 Phase 3：精简规则文件（优先级 P2）

| 任务 | 工作量 | 说明 |
|------|-------|------|
| 精简 .cursorrules | 0.5 天 | 从 487 行减少到 100 行 |
| 精简 workflow 文件 | 1 天 | 移除冗余内容 |
| 更新 README | 0.5 天 | 反映新流程 |

**产出**：更轻量的规则文件

---

## 6. 风险评估

### 6.1 改造风险

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 破坏现有项目 | 高 | 保持向后兼容，旧命令仍可用 |
| 检查逻辑误判 | 中 | 提供 `--force` 跳过检查 |
| 用户习惯改变 | 中 | 提供迁移指南 |

### 6.2 向后兼容策略

```bash
# 旧命令仍可用
prd baseline create A0  # 仍可单独创建
prd baseline create A1  # 仍可单独创建
prd review r1           # 仍可手动执行

# 新命令
prd plan freeze         # 自动执行 R1 + B3
prd version freeze      # 自动执行 R2 + C3

# 跳过检查（紧急情况）
prd plan freeze --force
prd version freeze --force
```

---

## 7. 总结

### 7.1 核心改变

| 改变 | 效果 |
|------|------|
| 12 步 → 6 步 | PM 执行负担减半 |
| 审视合并到 freeze | 不会被跳过 |
| 程序强制检查 | 不依赖 AI 记忆 |
| 检查不通过则阻断 | 质量有保障 |

### 7.2 PM 只需记住

```
1. prd init           → 创建项目基线
2. prd plan create B1 → 写规划草案
3. prd plan create B2 → 写需求拆解
4. prd plan freeze    → 冻结规划（自动审视）
5. prd version create C1 → 写需求清单
6. prd version freeze → 冻结版本（自动审视）
```

**就这 6 个命令，其他都是程序自动处理。**

---

> 📝 **待确认事项**
> 
> 1. 是否需要 `--force` 选项跳过检查？
> 2. A0 合并后是否需要保留单独创建 A1/A2 的能力？
> 3. 是否需要迁移工具帮助现有项目升级？
