# PRD-CLI 与 Claude Code Agent Skill 对比分析

> 📅 分析日期：2024-12-30
> 
> 📌 目的：评估 PRD-CLI 的架构设计与 Claude Code Agent Skill 理念的契合度，为后续优化提供参考

---

## 目录

1. [Claude Code Agent Skill 核心理念](#1-claude-code-agent-skill-核心理念)
2. [PRD-CLI 现状分析](#2-prd-cli-现状分析)
3. [对比分析总表](#3-对比分析总表)
4. [详细对比](#4-详细对比)
5. [改造收益评估](#5-改造收益评估)
6. [核心痛点分析](#6-核心痛点分析)
7. [结论与建议](#7-结论与建议)
8. [后续行动计划](#8-后续行动计划)

---

## 1. Claude Code Agent Skill 核心理念

### 1.1 设计哲学

Claude Code Agent Skill 的核心理念是**动态、按需的专业知识注入**，将通用 AI 转化为特定领域的专家。

#### 关键概念

| 概念 | 说明 |
|------|------|
| **模块化可复用专业知识** | Skill 是模块化的"可执行专业知识"，像组织好的文件夹一样打包领域知识 |
| **领域专业化** | AI 配备 Skill 后成为特定领域专家，减少重复提示 |
| **模型自主调用** | Claude 自主决定何时需要某个 Skill，用户无需显式调用 |
| **动态认知注入** | 在运行时动态注入"领域专家大脑"，而非仅提供工具 |
| **渐进式披露** | 只在需要时加载信息，防止上下文窗口过载 |

### 1.2 架构设计

#### 文件系统结构

```
.claude/skills/
├── my-skill/
│   ├── SKILL.md          # 核心入口文件
│   ├── scripts/          # 可执行脚本
│   └── templates/        # 模板文件
```

#### SKILL.md 格式

```yaml
---
name: Skill 名称
description: 触发条件描述（Claude 用于判断何时使用）
allowed-tools:
  - file_read
  - file_write
  - bash_execute
---

# Skill 详细指令

[具体的执行步骤和规则]
```

#### 三层渐进加载机制

| 层级 | 加载时机 | 内容 | Token 消耗 |
|------|---------|------|-----------|
| **Level 1: 元数据** | 始终加载 | 名称 + 描述 | 30-50 tokens/skill |
| **Level 2: 指令** | 触发时加载 | 完整 SKILL.md | 按需 |
| **Level 3: 资源** | 需要时加载 | 脚本、模板等 | 按需 |

#### Skill 存储位置

| 位置 | 路径 | 作用域 |
|------|------|--------|
| 个人级 | `~/.claude/skills/` | 用户所有项目 |
| 项目级 | `.claude/skills/` | 当前项目 |
| 插件级 | bundled | 特定插件 |

### 1.3 Skill 要解决的核心问题

| 问题 | 描述 | Skill 解决方案 |
|------|------|---------------|
| **上下文窗口污染** | 过多信息导致重要内容被"稀释" | 渐进式加载，只加载需要的 |
| **流程幻觉** | 模型知道目标但选错执行路径 | 明确的指令和步骤定义 |
| **能力僵化** | 难以扩展到新领域 | 模块化、可插拔的 Skill 架构 |

---

## 2. PRD-CLI 现状分析

### 2.1 项目定位

PRD-CLI 是一个**产品需求管理规范命令行工具**，核心理念是通过**严格的流程控制**帮助产品团队和 AI 编程助手完成规范化需求管理。

#### 核心特点

- ✅ 强制审视机制（R1/R2 作为"闸门"）
- ✅ 文档模板化
- ✅ AI 可执行（配合 Cursor 等 AI IDE）
- ✅ 阶段清晰（A→R→B→C 流程）
- ✅ 防止失控（强制约束防止规划膨胀）

### 2.2 现有架构

#### 目录结构

```
prd-cli/
├── .agent/
│   └── workflows/           # AI 工作流定义
│       ├── prd-b1-planning-draft.md
│       ├── prd-b2-planning-breakdown.md
│       ├── prd-c1-requirement-list.md
│       ├── prd-r1-review.md
│       ├── prd-r2-review.md
│       └── ...
├── .cursorrules             # Cursor IDE 规则（487 行）
├── .antigravity/
│   └── rules.md             # Antigravity 规则
├── rules/
│   ├── index.json           # 37 条规则定义
│   └── schemas/             # 规则 Schema
├── commands/                # CLI 命令实现
├── templates/               # 文档模板
└── ...
```

#### Workflow 文件格式

```yaml
---
description: B1 需求规划草案填写工作流
---

# B1 需求规划草案填写工作流

## 🚨 本阶段必须遵守的规则

| ID | 规则 | 严重程度 | 自检 |
|----|------|----------|------|
| G001 | ... | 🔴 严重 | ☐ |
| ... | ... | ... | ... |

[详细执行步骤]
```

#### 规则系统

| 分类 | 说明 | 校验方式 |
|------|------|----------|
| **G - 全局红线** | 基本行为准则 | AI 自检 |
| **D - 文档状态** | 冻结保护 | `prd check` 程序校验 |
| **F - 流程顺序** | 阶段前置检查 | `prd check` 程序校验 |
| **S - 需求范围** | 范围控制 | `prd check` 程序校验 |
| **V - A2UI可视化** | 文件/命名/Schema | `prd check` 程序校验 |
| **I - 分段保存** | 即时写入 | AI 自检 |
| **U - 用户角度** | 用户视角审计 | AI 自检 |
| **C - 完整性检查** | 5 维度闭环 | AI 自检 |
| **W - 工作启动** | 开始前检查 | 混合 |

### 2.3 工作流程

```
A 阶段（基线）
  A0 → A1 → A2 → R0          = 4 步

↓ R0 通过后

B 阶段（规划）
  创建迭代 → B1 → B2 → R1 → B3（冻结）  = 5 步

↓ B3 冻结后

C 阶段（版本）
  C0 → C1 → R2 → C3（冻结）    = 4 步

总计：12+ 步骤
```

---

## 3. 对比分析总表

| 特性 | Claude Code Agent Skill | PRD-CLI | 契合度 | 说明 |
|------|------------------------|---------|--------|------|
| **模块化专业知识** | ✅ Skill 目录 | ✅ workflows 目录 | 🟢 高 | 理念一致 |
| **领域专业化** | ✅ 转化为专家 | ✅ "战略思维导师" | 🟢 高 | 理念一致 |
| **文件系统架构** | ✅ .claude/skills/ | ✅ .agent/workflows/ | 🟢 高 | 结构相似 |
| **YAML frontmatter** | ✅ | ✅ | 🟢 高 | 格式一致 |
| **规则系统** | ✅ allowed-tools | ✅ 37条规则 + index.json | 🟢 高 | PRD-CLI 更完善 |
| **三层渐进加载** | ✅ 严格三层 | ⚠️ 有分层但不够轻量 | 🟡 中 | 需要优化 |
| **模型自主调用** | ✅ 基于 description | ⚠️ 依赖 slash 命令 | 🟡 中 | 但对严格流程可能是优势 |
| **SKILL.md 入口** | ✅ 统一入口 | ❌ 分散在多处 | 🔴 低 | 缺失 |
| **工具权限控制** | ✅ allowed-tools | ⚠️ 用红线替代 | 🟡 中 | 不够精确 |
| **可执行脚本层** | ✅ scripts/ | ⚠️ CLI 独立 | 🟡 中 | 未集成 |
| **多级组织** | ✅ 个人/项目/插件 | ❌ 仅项目级 | 🔴 低 | 缺失 |

---

## 4. 详细对比

### 4.1 高度契合的方面

#### 4.1.1 模块化可复用专业知识

**Claude Code 理念**：Skills 是模块化的"可执行专业知识"

**PRD-CLI 实现**：
```
.agent/workflows/
├── prd-b1-planning-draft.md    # B1 阶段完整专业知识
├── prd-b2-planning-breakdown.md # B2 阶段完整专业知识
├── prd-c1-requirement-list.md  # C1 阶段完整专业知识
└── ...
```

每个 workflow 文件包含：
- 规则表（开头的规则子集）
- 详细执行步骤
- 正确/错误示例
- 自检清单

**评价**：✅ **完美契合**

#### 4.1.2 领域专业化

**Claude Code 理念**：让通用 AI 变成特定领域专家

**PRD-CLI 实现**：
- 将 AI 定位为"PRD 工作流战略思维导师"
- 明确角色边界："PM 决策，AI 执行"
- 核心原则："你是战略思维导师，不是自动化工具"

**评价**：✅ **完美契合**

#### 4.1.3 规则系统

**Claude Code 理念**：通过 allowed-tools 等控制 AI 行为

**PRD-CLI 实现**：
- 37 条规则定义（rules/index.json）
- 9 类规则分类
- `prd check` 程序化校验
- AI 自检机制

**评价**：✅ **甚至超越 Claude Code 的规则系统**

### 4.2 部分契合的方面

#### 4.2.1 渐进式加载

**Claude Code 理念**：
```
Level 1: 元数据（始终加载）    → 30-50 tokens/skill
Level 2: 指令（触发时加载）    → 完整 SKILL.md
Level 3: 资源（需要时加载）    → 脚本、模板等
```

**PRD-CLI 现状**：
- Level 1：`.cursorrules` 有概述，但 **487 行太长**
- Level 2：Workflow 文件 **400-600 行**
- Level 3：模板存在但 **没有按需加载机制**

**差距**：
- .cursorrules 太长，应该只保留核心摘要
- 没有真正的"按需加载"机制
- 缺少 SKILL.md 核心入口文件

#### 4.2.2 模型自主调用

**Claude Code 理念**：AI 自主判断何时需要哪个 Skill

**PRD-CLI 现状**：
- 使用 slash 命令触发：`/prd-r1-review`
- 或程序化校验：`prd check`

**分析**：
对于 PRD 工作流这种**严格流程驱动**的场景，**显式触发可能比自主调用更可靠**。

自主调用的风险：
- AI 可能判断错误，用错 workflow
- 对于需要严格顺序执行的流程，显式控制更安全

### 4.3 缺失的方面

#### 4.3.1 缺少 SKILL.md 入口

**问题**：知识分散在 `.cursorrules` + `.antigravity/rules.md` + `workflows/*.md`

**建议结构**：
```
.claude/skills/prd-workflow/
├── SKILL.md          # 统一入口
├── workflows/        # 具体工作流
├── rules/            # 规则定义
└── templates/        # 模板
```

#### 4.3.2 缺少多级组织

**问题**：只有项目级（.agent/workflows/），没有个人级或全局级

**影响**：用户不能在多个项目间共享通用规则

---

## 5. 改造收益评估

### 5.1 如果完全按 Skill 架构改造

#### 改造成本

| 工作项 | 工作量 | 风险 |
|-------|-------|------|
| 创建 .claude/skills/ 目录结构 | 低 | 低 |
| 编写 SKILL.md 入口文件 | 低 | 低 |
| 精简 .cursorrules | 中 | **高**（可能破坏现有行为） |
| 重构 workflow 文件 | 高 | **高**（大量内容迁移） |
| 测试和验证 | 高 | 中 |

**总成本**：**中高**

#### 预期收益

| 收益项 | 程度 | 确定性 |
|-------|------|-------|
| 减少上下文占用 | 低 | 高 |
| 减少流程幻觉 | **很低** | 低 |
| 提升可扩展性 | 中 | 中 |
| 符合"最佳实践" | 高 | 高 |

**总收益**：**低到中**

### 5.2 关键洞察

> **Skill 架构不能直接解决流程幻觉问题！**

它只是一种组织方式。真正解决流程幻觉的是：
- 程序化校验（prd check）
- 规则系统（37 条规则）
- 自检清单
- 红线约束

这些 PRD-CLI **已经实现**。

### 5.3 场景验证

#### 场景 1：创建 B1 规划

| 方式 | 流程 | 效果差异 |
|------|------|---------|
| 现在 | 用户调用 → 加载 workflow 487 行 → 执行 | - |
| Skill 架构 | 用户调用 → 加载 SKILL.md → 加载 workflow | **几乎没有** |

#### 场景 2：PM 说"帮我快速完成"

| 方式 | 处理 | 效果差异 |
|------|------|---------|
| 现在 | 规则在 .cursorrules 中，可能被忽略 | - |
| Skill 架构 | 规则在 SKILL.md 中，同样可能被忽略 | **几乎没有** |

#### 场景 3：长对话后的规则遗忘

| 方式 | 处理 | 效果差异 |
|------|------|---------|
| 现在 | 规则被新对话"稀释" | - |
| Skill 架构 | Skill 不会重新加载，同样会遗忘 | **几乎没有** |

---

## 6. 核心痛点分析

### 6.1 真正的问题

PRD-CLI 面临的核心问题不是"架构不够好"，而是：

```
          流程复杂度
              ↑
   质量保证高  |  ●当前位置
              |     ↖ PM 和 AI 都容易遗漏
              |       
              |        
   质量保证低  |
              +——————————————→ 执行负担
                    低    高
```

1. **AI 不可能彻底避免流程幻觉** → 需要 PM 提醒
2. **流程步骤太多（12+ 步）** → PM 也会遗漏
3. **形成双重遗漏风险**

### 6.2 当前流程复杂度统计

```
完整流程 = 12+ 个主要步骤

A 阶段：A0 → A1 → A2 → R0          = 4 步
B 阶段：迭代 → B1 → B2 → R1 → B3   = 5 步
C 阶段：C0 → C1 → R2 → C3          = 4 步

每个步骤内部还有：
- 多个必填维度
- 自检清单
- 触发规则
- 审视点
```

### 6.3 Skill 架构能解决这个问题吗？

**答案：不能。**

Skill 架构解决的是"知识组织"问题，不是"流程执行"问题。

---

## 7. 结论与建议

### 7.1 核心结论

| 判断 | 结论 |
|------|------|
| 是否需要完全按 Skill 架构重构？ | **否** |
| 现有架构是否需要改进？ | 可选，但不是优先级 |
| 核心痛点是什么？ | 流程复杂 + 双重遗漏风险 |
| 应该优先做什么？ | 简化流程 + 关键节点守卫 |

### 7.2 推荐策略：混合方案

不是三选一，而是**组合使用**：

```
┌─────────────────────────────────────────────────────────┐
│                    简化流程                             │
│        ↓ 合并可合并的步骤，12 步减少到 6 步              │
├─────────────────────────────────────────────────────────┤
│               只在 2 个关键节点设守卫                    │
│        ↓ B3 冻结前 + C3 冻结前                          │
├─────────────────────────────────────────────────────────┤
│              规则内嵌到命令中                            │
│        ↓ prd plan freeze 自动检查，不通过就阻断          │
└─────────────────────────────────────────────────────────┘
```

### 7.3 精简后的流程

**现状 12 步 → 精简为 6 步**

| 现状 | 简化后 | 说明 |
|------|--------|------|
| A0 → A1 → A2 → R0 | **A0** (含 R0) | 立项时一次完成基线 |
| 创建迭代 → B1 → B2 → R1 → B3 | **B1** → **B2** → **B3**(含 R1) | 合并迭代创建和 R1 |
| C0 → C1 → R2 → C3 | **C1** → **C3**(含 R2) | C0 合并到 C1 |

### 7.4 关键节点守卫

```bash
# B3 冻结命令自动检查
prd plan freeze
# 自动执行：
# 1. 检查 B1、B2 是否存在
# 2. 检查必填项是否完成
# 3. 执行 R1 审视（5 维度）
# 4. 任何不通过 → 阻断冻结

# C3 冻结命令自动检查
prd version freeze
# 自动执行：
# 1. 检查 C1 是否存在
# 2. 检查需求是否在 B3 范围内
# 3. 执行 R2 审视
# 4. 任何不通过 → 阻断冻结
```

### 7.5 核心思路

> **不要让 AI 或 PM 记住规则，而是让程序在关键节点强制执行。**

---

## 8. 后续行动计划

### 优先级 P0：精简流程

- [ ] 重新定义 6 步流程
- [ ] 合并 A0/A1/A2/R0 为统一的立项文档
- [ ] 合并 C0 到 C1
- [ ] 更新文档模板

### 优先级 P1：改造 freeze 命令

- [ ] 在 `prd plan freeze` 中添加前置检查
- [ ] 在 `prd version freeze` 中添加前置检查
- [ ] 不通过时阻断并提示

### 优先级 P2：精简规则文件

- [ ] 将 .cursorrules 精简到 100 行以内
- [ ] 只保留核心 10 条红线规则
- [ ] 其余规则内嵌到 freeze 命令中

### 可选：部分采用 Skill 架构

- [ ] 创建 SKILL.md 入口文件（可选）
- [ ] 优化 description 语义（可选）

---

## 附录：参考资料

### Claude Code Agent Skill 官方文档

- [Anthropic Skills Documentation](https://docs.anthropic.com)
- Claude Code 官方技术博客

### PRD-CLI 相关文档

- `.cursorrules` - 487 行规则定义
- `rules/index.json` - 37 条规则
- `.agent/workflows/` - 10 个工作流文件

---

> 📝 **文档维护说明**
> 
> 本文档为架构对比分析，用于指导后续优化决策。
> 如有更新，请在此处记录变更历史。

| 日期 | 变更内容 | 作者 |
|------|---------|------|
| 2024-12-30 | 初始版本 | AI 分析 |
