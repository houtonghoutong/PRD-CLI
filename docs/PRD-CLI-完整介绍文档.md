# PRD-CLI 完整介绍文档

> 产品需求管理规范命令行工具 —— 让 AI 从"帮你写需求"变成"帮你挡住不该写的需求"

---

## 📋 目录

1. [工具概述](#1-工具概述)
2. [核心理念与设计哲学](#2-核心理念与设计哲学)
3. [工作流程详解](#3-工作流程详解)
4. [系统架构与组成](#4-系统架构与组成)
5. [核心机制](#5-核心机制)
6. [命令参考手册](#6-命令参考手册)
7. [文档结构与模板](#7-文档结构与模板)
8. [AI 集成与协作](#8-ai-集成与协作)
9. [A2UI 可视化系统](#9-a2ui-可视化系统)
10. [安装与快速开始](#10-安装与快速开始)
11. [典型使用场景](#11-典型使用场景)
12. [常见问题解答](#12-常见问题解答)
13. [版本历史](#13-版本历史)

---

## 1. 工具概述

### 1.1 什么是 PRD-CLI？

**PRD-CLI** (prd-workflow-cli) 是一个基于严格产品需求管理规范的命令行工具，专为**产品经理 + AI 编程助手**的协作场景设计。

它不是一个传统的项目管理工具，而是：

> **一套嵌入 AI 编程助手的工作流规范引擎**

通过 CLI 命令 + 规则文件 + 工作流指引的组合，确保 AI 在产品工作中：
- 🛡️ 遵循阶段化结构
- 🎯 尊重 PM 决策权
- ⛔ 不越权执行

### 1.2 核心特点

| 特点 | 说明 |
|------|------|
| **强制审视机制** | R1/R2 作为"闸门"，必须通过才能进入下一阶段 |
| **文档模板化** | 每个阶段都有明确的文档结构和填写指引 |
| **AI 可执行** | 配合 Cursor、Windsurf、Codeium 等 AI IDE 使用 |
| **阶段清晰** | A(基线) → R(审视) → B(规划) → C(版本) 流程明确 |
| **防止失控** | 通过强制约束防止规划膨胀和需求蔓延 |
| **PM 决策权保障** | 核心决策由人类做出，AI 辅助执行 |

### 1.3 技术信息

| 项目 | 信息 |
|------|------|
| **当前版本** | v1.4.1 |
| **许可协议** | MIT |
| **Node.js 要求** | >= 14.0.0 |
| **NPM 包名** | prd-workflow-cli |
| **GitHub** | https://github.com/houtonghoutong/PRD-CLI |

---

## 2. 核心理念与设计哲学

### 2.1 项目背景

随着大模型能力的成熟，AI 已经从早期的工具性使用（如文案生成、代码补全），逐步演进为**深度参与产品工作的协作角色**。

在 AI 深度参与产品工作后，传统方法论的前提发生了根本变化：
- 需求分析、方案推演、文档生成可被即时完成
- 思考与输出的节奏被显著加速
- 多角色、多视角的推演可在极短时间内完成

**这并非单纯的效率提升，而是对原有工作方式的结构性冲击。**

### 2.2 核心矛盾

> **产品工作的"生产能力"已进入 AI 协作时代，但"组织化、规模化的工作方法"仍停留在前 AI 时代。**

如果不对产品工作方式进行系统性升级，将直接导致：
- 工作高度依赖个人能力与习惯
- 项目经验难以沉淀为组织资产
- 随着 AI 使用加深，复杂度而非可控性持续上升

### 2.3 设计原则

PRD-CLI 的设计遵循以下核心原则：

| 原则 | 说明 |
|------|------|
| **PM 决策，AI 执行** | AI 不作为决策主体，其输出仅作为参考与辅助材料 |
| **优先保证决策清晰** | 而非文档完备 |
| **优先约束 AI 参与方式** | 而非限制其能力使用 |
| **阶段内灵活，边界处收敛** | 允许阶段内灵活调整，但必须在阶段边界处收敛 |
| **实践中演进** | 允许在实践中发现问题，并反向修订规范本身 |

### 2.4 工具价值定位

PRD-CLI 的核心价值不是"写更多文档"，而是：

> **"防止写错误的文档"**

让 AI 从"陪你写需求"变成"帮你挡住不该写的需求"。

---

## 3. 工作流程详解

### 3.1 四阶段工作流：A → R → B → C

```
┌────────────────────────────────────────────────────────────┐
│                    A 阶段（基线建立）                        │
│   A0 产品基础与范围 → A1 已上线功能清单 → A2 存量反馈汇总     │
│                           ↓                                 │
│                    R0 基线审视报告                           │
└────────────────────────────────────────────────────────────┘
                            ↓ R0 通过后
┌────────────────────────────────────────────────────────────┐
│                    B 阶段（规划设计）                        │
│   创建迭代 → R1启动检查 → B1 需求规划草案 → B2 规划拆解      │
│                           ↓                                 │
│              R1 规划审视 → B3 规划冻结归档                   │
└────────────────────────────────────────────────────────────┘
                            ↓ B3 冻结后
┌────────────────────────────────────────────────────────────┐
│                    C 阶段（版本细化）                        │
│   C0 首版概述 → C1 版本需求清单 → C2 变更跟踪               │
│                           ↓                                 │
│              R2 版本审视 → C3 版本冻结归档                   │
└────────────────────────────────────────────────────────────┘
```

### 3.2 详细流程图

```
A 类(现状基线)
    ↓
R1 启动条件检查 → 不通过则停止
    ↓ 通过
B1/B2(需求规划)
    ↓
R1 规划审视 → 不通过则返回修改
    ↓ 通过
B3(规划冻结)
    ↓
C0/C1(版本需求)
    ↓
R2 版本审视 → 不通过则返回修改
    ↓ 通过
C3(版本冻结)
```

### 3.3 阶段说明

| 阶段 | 目的 | 核心问题 | 核心文档 |
|------|------|----------|----------|
| **A 阶段** | 建立基线，搞清楚现状 | 产品目前是什么样？ | A0、A1、A2 |
| **R0** | 审视基线是否完整可靠 | 基线是否稳定？ | R0 基线审视报告 |
| **B 阶段** | 规划设计，明确要做什么 | 要不要做？做什么？ | B1、B2、B3 |
| **R1** | 审视规划是否成熟可行 | 规划能否进入执行？ | R1 规划审视报告 |
| **C 阶段** | 版本细化，明确怎么做 | 这个版本具体做什么？ | C0、C1、C2、C3 |
| **R2** | 审视版本是否可交付 | 版本需求是否就绪？ | R2 版本审视报告 |

### 3.4 关键原则

1. **R1 是启动闸门**: 必须满足三个条件才能开始规划
   - 问题真实存在(基于 A 类现状)
   - 值得单独规划(不是小修小补)
   - 问题已理解清楚(不用规划来想问题)

2. **B3 是决策冻结**: 规划一旦冻结不可随意更改

3. **C 类不讨论方向**: 只执行已冻结的规划，不再讨论"该不该做"

4. **审视是强制的**: R1/R2 必须通过才能进入下一阶段

---

## 4. 系统架构与组成

### 4.1 整体架构

```
PRD-CLI
├── CLI 命令层             # 命令行接口
│   ├── init              # 项目初始化
│   ├── baseline          # 基线管理
│   ├── iteration         # 迭代管理
│   ├── plan              # 规划管理
│   ├── version           # 版本管理
│   ├── review            # 审视管理
│   ├── check             # 规则校验
│   ├── stats             # 统计报告
│   └── upgrade           # 升级更新
│
├── 规则层                  # AI 行为控制
│   ├── .cursorrules       # Cursor IDE 规则
│   ├── .antigravity/      # Antigravity 规则
│   └── rules/             # 规则定义
│
├── 工作流层               # 流程指引
│   └── .agent/workflows/  # 10 个工作流文件
│
└── 模板层                 # 文档模板
    └── templates/         # 文档模板
```

### 4.2 核心组件

| 组件 | 路径 | 功能 |
|------|------|------|
| **CLI 入口** | `bin/prd-cli.js` | 命令行入口 |
| **命令处理** | `commands/*.js` | 15 个命令模块 |
| **工作流** | `.agent/workflows/*.md` | 10 个工作流指引 |
| **AI 规则** | `.cursorrules`, `.antigravity/` | AI 行为约束 |
| **模板** | `templates/` | 文档模板 |
| **规则定义** | `rules/` | 规则配置 |

### 4.3 工作流文件清单

| 文件 | 用途 |
|------|------|
| `prd-p0-project-info.md` | P0 项目基本信息填写指引 |
| `prd-a2ui-guide.md` | A2UI 可视化指南 |
| `prd-b1-planning-draft.md` | B1 需求规划草案填写工作流 |
| `prd-b2-planning-breakdown.md` | B2 规划拆解与范围界定工作流 |
| `prd-c1-requirement-list.md` | C1 版本需求清单填写工作流 |
| `prd-c2-change-tracking.md` | C2 变更跟踪工作流 |
| `prd-dialog-archive.md` | 对话归档工作流 |
| `prd-r0-baseline-review.md` | R0 基线审视工作流 |
| `prd-r1-review.md` | R1 规划审视工作流 |
| `prd-r2-review.md` | R2 版本审视工作流 |

---

## 5. 核心机制

### 5.1 冻结点机制

每个阶段的结束都有**冻结点**，一旦冻结：
- 不允许修改已冻结的文档
- 新需求只能暂存到 A2，等待下一轮迭代

| 冻结点 | 触发命令 | 效果 |
|--------|----------|------|
| B3 冻结 | `prd plan freeze` | B1、B2 不可再修改 |
| C3 冻结 | `prd version freeze` | C0、C1 不可再修改 |

### 5.2 R1 双阶段检查

R1 分为两个阶段，防止 AI 跳过必要的审视：

| 阶段 | 时机 | 检查内容 |
|------|------|----------|
| **R1 启动检查** | 创建迭代后 | 问题是否真实存在？是否值得单独规划？边界是否清楚？ |
| **R1 规划审视** | B1/B2 后 | 目标清晰性、场景真实性、现状一致性、范围收敛性、版本化准备度 |

**R1 启动检查的三个条件**：
1. ✅ 问题是否被确认真实存在（基于 A 类文档）
2. ✅ 问题是否需要"单独一轮规划"来解决
3. ✅ 问题是否已理解到"可规划"的程度

### 5.3 R1 规划审视 (五个维度)

1. **目标清晰性** - 规划目标是否明确可衡量
2. **场景真实性** - 使用场景是否基于真实数据
3. **现状一致性** - 是否与 A 类基线文档一致
4. **范围收敛性** - 范围是否明确收敛
5. **版本化准备度** - 是否具备拆分为版本的条件

### 5.4 R2 版本审视 (五个维度)

1. **版本目标一致性** - 是否忠于 B3 规划
2. **版本范围偏移检查** - 有没有"顺手加戏"
3. **规划覆盖完整性** - B3 的内容是否都覆盖
4. **需求粒度成熟度** - 需求是否足够细化
5. **进入执行准备度** - 是否可以开始开发

### 5.5 AI 行为红线

通过 `.cursorrules` 文件植入 AI 编程助手，确保 AI 遵循规则：

```
1. ❌ 禁止未经对话就填充文档 → 必须通过提问引导 PM 填写
2. ❌ 禁止替 PM 做决策 → 优先级、范围、目标都由 PM 决定
3. ❌ 禁止"快速完成"跳过流程 → 每个阶段都要充分对话和审视
4. ❌ 禁止修改已冻结的文档 → B3/C3 冻结后不能改
5. ❌ 禁止在 C1 阶段加入新需求 → 新需求只能暂存到 A2
6. ❌ 禁止跳过审视 → B2 后必须 R1，C1 后必须 R2
7. ❌ 禁止 R1 直接输出"通过" → 必须有 5 维度分析和评估矩阵
8. ❌ 禁止创建迭代后直接创建 B1 → 必须先引导 PM 填写 R1 启动检查
```

### 5.6 规则校验机制 (v1.4.0+)

PRD-CLI 提供了自动化的规则校验功能：

```bash
# 检查项目是否符合 PRD 规则
prd check

# 输出 JSON 格式（供 AI 读取）
prd check --json

# 显示规则统计报告
prd stats
```

---

## 6. 命令参考手册

### 6.1 项目管理命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `prd init <name>` | 初始化新项目 | `prd init my-product` |
| `prd init .` | 在当前目录初始化 | `prd init .` |
| `prd status` | 查看项目状态 | `prd status` |
| `prd upgrade` | 更新 workflows 和 AI 规则 | `prd upgrade` |
| `prd index` | 生成/更新迭代索引 | `prd index` |

### 6.2 基线管理命令 (A 类)

| 命令 | 说明 |
|------|------|
| `prd baseline create A0` | 创建产品基础与范围说明 |
| `prd baseline create A1` | 创建已上线功能与流程清单 |
| `prd baseline create A2` | 创建存量反馈与数据汇总 |
| `prd baseline create R0` | 创建基线审视报告 |

### 6.3 迭代管理命令

| 命令 | 说明 |
|------|------|
| `prd iteration new` | 开始新迭代 |
| `prd iteration list` | 列出所有迭代 |
| `prd iteration current` | 查看当前迭代 |

### 6.4 规划管理命令 (B 类)

| 命令 | 说明 |
|------|------|
| `prd plan create B1` | 创建需求规划草案 |
| `prd plan create B2` | 创建规划拆解与范围界定 |
| `prd plan freeze` | 冻结规划(生成 B3) |

### 6.5 版本管理命令 (C 类)

| 命令 | 说明 |
|------|------|
| `prd version create C0` | 创建版本范围声明 |
| `prd version create C1` | 创建版本需求清单 |
| `prd version freeze` | 冻结版本(生成 C3) |

### 6.6 审视管理命令 (R 类)

| 命令 | 说明 |
|------|------|
| `prd review r0` | 执行 R0 基线审视 |
| `prd review r1` | 执行 R1 规划审视 |
| `prd review r2` | 执行 R2 版本审视 |

### 6.7 规则校验命令 (v1.4.0+)

| 命令 | 说明 |
|------|------|
| `prd check` | 检查项目是否符合 PRD 规则 |
| `prd check --json` | 输出 JSON 格式（供 AI 读取） |
| `prd check --no-log` | 不记录日志 |
| `prd stats` | 显示规则统计报告 |
| `prd stats --json` | 输出 JSON 格式统计 |

### 6.8 其他命令

| 命令 | 说明 |
|------|------|
| `prd ui [file]` | 启动 A2UI 界面预览服务 |
| `prd --help` | 显示帮助信息 |
| `prd --version` | 显示版本号 |

---

## 7. 文档结构与模板

### 7.1 项目目录结构

```
项目名/
├── .prd-config.json      # 项目配置文件
├── .agent/workflows/     # AI 工作流指引（10 个）
├── .cursorrules          # Cursor AI 规则
├── .antigravity/         # Antigravity AI 规则
│
├── 00_项目总览/
│   └── P0_项目基本信息.md
│
├── 01_产品基线/          # A 类文档
│   ├── A0_产品基础与范围说明.md
│   ├── A1_已上线功能与流程清单.md
│   ├── A2_存量反馈与数据汇总.md
│   └── R0_基线审视报告.md
│
├── 02_迭代记录/          # B/C 类文档（按迭代组织）
│   ├── 第01轮迭代/
│   │   ├── R1_规划启动条件检查.md
│   │   ├── B1_需求规划草案.md
│   │   ├── B2_规划拆解与范围界定.md
│   │   ├── R1_规划审视报告.md
│   │   ├── B3_规划冻结归档.md
│   │   ├── C0_首版概述.md
│   │   ├── C1_版本需求清单.md
│   │   ├── C2_变更跟踪.md
│   │   ├── R2_版本审视报告.md
│   │   └── C3_版本冻结归档.md
│   └── 第02轮迭代/
│       └── ...
│
├── 98_对话归档/          # PM 确认记录
└── 99_归档区/            # 历史文档
    └── 历史参考与废弃文档/
```

### 7.2 文档分类说明

#### A 类 - 现状基线文档

用于建立产品现状的共识，不写规划和愿景。

| 文档 | 用途 | 核心内容 |
|------|------|----------|
| **A0** | 产品基础与范围说明 | 产品是什么、目标用户、核心场景、当前不支持什么 |
| **A1** | 已上线功能与流程清单 | 所有已存在的功能和用户路径 |
| **A2** | 存量反馈与数据汇总 | 用户反馈、数据异常、已知问题 |
| **R0** | 基线审视报告 | 确认基线稳定 |

#### B 类 - 需求规划文档

定义"要不要做、做什么、做到什么程度"。

| 文档 | 用途 | 核心内容 |
|------|------|----------|
| **R1** | 规划启动条件检查 | 三个启动条件确认 |
| **B1** | 需求规划草案 | 规划目标、使用场景、核心需求、明确不做什么 |
| **B2** | 规划拆解与范围界定 | 需求拆解、优先级、边界划定 |
| **R1** | 规划审视报告 | 五维度审视结论 |
| **B3** | 规划冻结归档 | 冻结后的规划文档 |

#### C 类 - 版本需求文档

将规划转化为可执行的版本需求。

| 文档 | 用途 | 核心内容 |
|------|------|----------|
| **C0** | 版本范围声明 | 版本目标、本版包含什么、不包含什么 |
| **C1** | 版本需求清单 | 逐条需求、目的说明、关键规则 |
| **C2** | 变更跟踪 | 版本冻结后的变更记录 |
| **R2** | 版本审视报告 | 五维度审视结论 |
| **C3** | 版本冻结归档 | 冻结后的版本文档 |

---

## 8. AI 集成与协作

### 8.1 支持的 AI IDE

PRD-CLI 专门设计用于与 AI 编程助手配合使用：

| IDE | 规则文件 | 说明 |
|-----|----------|------|
| **Cursor** | `.cursorrules` | 自动加载项目规则 |
| **Windsurf** | `.cursorrules` | 兼容 Cursor 规则 |
| **Codeium** | `.cursorrules` | 兼容 Cursor 规则 |
| **Antigravity (Google)** | `.antigravity/rules.md` | 专用规则文件 |

### 8.2 AI 工作流调用

工具会自动在项目中创建 `.agent/workflows/` 目录，包含可被 AI 调用的工作流文件。

在 AI 对话中使用斜杠命令：

```
/prd-b1-planning-draft   # B1 需求规划草案填写
/prd-b2-planning-breakdown  # B2 规划拆解工作流
/prd-c1-requirement-list  # C1 版本需求清单填写
/prd-r0-baseline-review  # R0 基线审视
/prd-r1-review           # R1 规划审视
/prd-r2-review           # R2 版本审视
```

### 8.3 AI 指令示例

**R1 规划审视**:
```
请按照 .agent/workflows/prd-r1-review.md 中的指令，
对当前的 B1、B2 文档执行 R1 规划审视。

请在 R1_规划审视报告.md 中填写审视结果,
并给出明确的通过/不通过结论。
```

**R2 版本审视**:
```
请按照 .agent/workflows/prd-r2-review.md 中的指令，
检查 C0、C1 是否忠实执行了 B3 的规划。

在 R2_版本审视报告.md 中填写结果。
```

### 8.4 在线 AI 提示词

如果使用 ChatGPT / Claude / Kimi 等在线 AI，可使用以下提示词：

<details>
<summary>📋 点击展开完整提示词</summary>

```
你是一个产品需求管理助手，帮助产品经理（PM）按照规范化流程完成需求文档。

# 你的角色
你是战略思维导师，不是自动化工具或速记员。

# 核心原则
PM 决策，AI 执行。你的职责是引导、提问、建议，不是替 PM 做决策。

# 工作流程
产品需求遵循 A → R → B → C 流程：
- A 类文档：产品基线（A0 产品基础、A1 功能清单、A2 用户反馈）
- R0：基线审视
- B 类文档：规划（B1 规划草案、B2 需求拆解、B3 规划冻结）
- R1：规划审视
- C 类文档：版本（C0 版本范围、C1 需求清单、C3 版本冻结）
- R2：版本审视

# 绝对禁止的行为

1. ❌ 禁止"快速完成模式"
   如果 PM 说"帮我快速完成"，你必须拒绝跳过流程。

2. ❌ 禁止未经对话就填充文档
   创建 B1/B2/C1 后，必须通过对话逐项引导 PM 填写。

3. ❌ 禁止替 PM 做决策
   优先级（P0/P1/P2）、首版范围、目标定义都由 PM 决定。

4. ❌ 禁止允许跳过必填内容
   C1 的前 5 个维度（背景/描述/规则/验收/边界）是必填的。

5. ❌ 禁止在 C1 阶段加入新需求
   C1 阶段发现新需求时，只能暂存到 A2，因为 B3 已冻结。

现在，请告诉我你想从哪个阶段开始，我会引导你完成。
```

</details>

**简化版提示词**（适合快速开始）:

```
你是产品需求管理助手，帮助 PM 按照 A→R→B→C 流程完成需求文档。
核心规则：PM 决策，AI 执行，不替 PM 做决策，每个阶段都要充分对话。
请告诉我你想从哪个阶段开始。
```

---

## 9. A2UI 可视化系统

### 9.1 什么是 A2UI？

**A2UI** (AI to UI) 是 PRD-CLI 内置的可视化原型系统，让 PM 可以通过 AI 对话生成：
- 📐 **架构图**：系统架构、模块结构、依赖关系
- 🎨 **界面原型**：表单页面、列表页面、详情页面

A2UI 基于 **JSON 驱动** + **Ant Design 渲染**，AI 生成标准 JSON 数据，浏览器实时渲染为可视化界面。

### 9.2 核心工作流

```
1. AI 生成数据：根据 PM 描述生成标准 JSON 数据
       ↓
2. 自动写入：AI 将数据写入 .a2ui/current.json 文件
       ↓
3. 实时预览：PM 运行 prd ui 在浏览器中查看
       ↓
4. 迭代修改：PM 提出反馈，AI 修改 JSON，PM 刷新浏览器
       ↓
5. 正式保存：PM 确认后，AI 保存到正式目录
```

### 9.3 启动预览服务

```bash
# 预览当前工作区文件 (.a2ui/current.json)
prd ui

# 预览指定 JSON 文件
prd ui ./path/to/specific.json

# 也可以通过 URL 参数指定文件
# http://localhost:3333/?file=02_迭代记录/第01轮迭代/C1_UI原型/REQ-001.json
```

启动后会自动打开浏览器访问 `http://localhost:3333`，实时渲染 A2UI 数据。

### 9.4 适用阶段

| 阶段 | 使用场景 | 生成内容 |
|------|----------|----------|
| **P0** | 项目整体架构、技术架构、干系人关系 | 架构图 |
| **B1** | 系统模块架构、功能结构 | 架构图 |
| **B2** | 需求结构图、依赖关系图、优先级矩阵 | 架构图 |
| **C1** | 表单页面、列表页面、详情页面 | 界面原型 |

### 9.5 架构图组件（P0/B1/B2 阶段）

#### 组件列表

| 组件 | 说明 | 属性 |
|------|------|------|
| **Diagram** | 架构图容器（紫色渐变背景） | `title`, `children` |
| **Layer** | 层级分区（水平排列子元素） | `title`, `children` |
| **DiagramGroup** | 虚线分组框 | `title`, `children` |
| **Box** | 模块方框 | `title`, `desc`, `color` |
| **Arrow** | 连接箭头 | `direction` (up/down/left/right), `label` |

#### JSON 示例

```json
{
  "type": "Page",
  "title": "系统架构图",
  "children": [
    {
      "type": "Diagram",
      "title": "产品管理系统架构",
      "children": [
        {
          "type": "Layer",
          "title": "用户层",
          "children": [
            { "type": "Box", "title": "产品经理", "desc": "需求规划", "color": "#3b82f6" },
            { "type": "Box", "title": "开发团队", "desc": "技术实现", "color": "#10b981" }
          ]
        },
        { "type": "Arrow", "direction": "down", "label": "需求流转" },
        {
          "type": "DiagramGroup",
          "title": "核心模块",
          "children": [
            { "type": "Box", "title": "需求管理", "color": "#8b5cf6" },
            { "type": "Box", "title": "版本规划", "color": "#8b5cf6" }
          ]
        }
      ]
    }
  ]
}
```

#### 保存规则

| 阶段 | 保存位置 |
|------|----------|
| **P0** | `00_项目总览/P0_架构图/` |
| **B1** | `02_迭代记录/第XX轮迭代/B1_架构图/` |
| **B2** | `02_迭代记录/第XX轮迭代/B2_架构图/` |

### 9.6 界面原型组件（C1 阶段）

#### 布局组件

| 组件 | 说明 | 属性 |
|------|------|------|
| **Page** | 根节点/页面 | `title`, `children` |
| **Panel** | 带边框面板 | `title`, `extra`, `children` |
| **Row** | 水平布局 | `children` |
| **Col** | 垂直/列布局 | `children` |
| **Divider** | 分隔线 | - |

#### 表单组件

| 组件 | 说明 | 属性 |
|------|------|------|
| **Input** | 输入框 | `label`, `placeholder`, `type`, `required` |
| **Textarea** | 多行输入 | `label`, `placeholder`, `rows` |
| **Select** | 下拉选择 | `label`, `options` (数组) |
| **Button** | 按钮 | `text`, `variant` (primary/secondary/success/danger) |

#### 展示组件

| 组件 | 说明 | 属性 |
|------|------|------|
| **Text** | 纯文本 | `content` |
| **Badge** | 徽章标签 | `text`, `variant` (primary/success/warning/danger) |
| **Alert** | 提示信息框 | `content`, `variant` (info/success/warning/danger) |

#### 数据组件

| 组件 | 说明 | 属性 |
|------|------|------|
| **Table** | 表格 | `columns`, `data` |
| **Card** | 卡片列表项 | `title`, `desc`, `actions` |
| **Tabs** | 标签页导航 | `items` (字符串数组) |
| **Upload** | 文件上传区 | `text` |

#### JSON 示例

```json
{
  "type": "Page",
  "title": "用户登录",
  "children": [
    {
      "type": "Panel",
      "title": "填写账户信息",
      "children": [
        { "type": "Input", "label": "用户名", "placeholder": "请输入用户名", "required": true },
        { "type": "Input", "label": "密码", "placeholder": "请输入密码", "type": "password" },
        { "type": "Button", "text": "登录", "variant": "primary" }
      ]
    }
  ]
}
```

#### 保存规则

**保存位置**：`02_迭代记录/第XX轮迭代/C1_UI原型/`

**保存文件**：
- `REQ-001-界面名称.json` - 数据结构（用于后续修改）
- `REQ-001-界面名称.html` - 独立预览文件（可直接分享）
- `index.md` - 索引目录

### 9.7 与 AI 协作生成原型

#### 对话示例

**PM**:
```
帮我生成一个用户登录界面的原型，包含：
- 用户名输入框
- 密码输入框
- 登录按钮
- 忘记密码链接
```

**AI 执行**:
1. 生成 A2UI JSON 数据
2. 写入 `.a2ui/current.json`
3. 提示 PM 运行 `prd ui` 查看

**PM 确认后**:
```
这个界面可以了，请保存为正式文件
```

**AI 保存**:
```
✅ 界面原型已保存！
📁 位置：02_迭代记录/第01轮迭代/C1_UI原型/
   - REQ-001-用户登录.json
   - REQ-001-用户登录.html
```

### 9.8 多文件管理

#### 命名规范

```
REQ-{编号}-{名称}.html
例如：REQ-003-用户反馈.html
```

#### 历史文件预览

**方法 A：命令行指定文件**
```bash
prd ui ./path/to/specific.json
```

**方法 B：浏览器 URL 参数（推荐）**
```
http://localhost:3333/?file=02_迭代记录/第01轮迭代/C1_UI原型/REQ-001.json
```

> 💡 **提示**：可以在 Markdown 文档中直接复制文件的相对路径，粘贴到 `file=` 后面。

### 9.9 A2UI 技术栈

| 技术 | 用途 |
|------|------|
| **React 18** | 组件渲染 |
| **Ant Design 5** | UI 组件库 |
| **JSON** | 数据描述格式 |
| **HTTP Server** | 本地预览服务 |

### 9.10 AI 避坑指南

| ❌ 禁止 | ✅ 正确做法 |
|---------|------------|
| 编造不存在的组件 | 只使用本文档定义的组件 |
| 忘记写入文件 | 必须调用 write_to_file 写入 .a2ui/current.json |
| 跳过保存步骤 | PM 确认后必须正式保存 |
| 混淆阶段 | 架构图用于 P0/B1/B2，界面原型用于 C1 |

---

## 10. 安装与快速开始

### 10.1 安装方式

#### 方式1：npx 直接运行（推荐新手）

无需全局安装，直接使用 npx 运行任何命令：

```bash
# 初始化新项目（推荐）
npx -y prd-workflow-cli@latest init 我的项目

# 或者进入空目录直接初始化
mkdir 我的项目 && cd 我的项目
npx -y prd-workflow-cli@latest init .

# 查看帮助
npx prd-workflow-cli@latest --help

# 规则校验
npx prd-workflow-cli@latest check

# 统计报告
npx prd-workflow-cli@latest stats
```

> 💡 **建议使用 `@latest` 确保使用最新版本**
> 
> ⚠️ 不加 `@latest` 可能使用缓存的旧版本

#### 方式2：全局安装（推荐频繁使用者）

```bash
npm install -g prd-workflow-cli

# 验证安装
prd --version  # 应该显示 1.4.1

# 然后直接使用 prd 命令
prd init 我的项目
prd check
prd stats
```

#### 方式3：从源码安装

```bash
git clone https://github.com/houtonghoutong/PRD-CLI.git
cd PRD-CLI/prd-cli
npm install
npm link
```

### 10.2 快速开始

#### 1. 初始化项目

```bash
# 使用 npx（推荐）
npx prd-workflow-cli init my-product
cd my-product

# 或者全局安装后使用
prd init my-product
cd my-product
```

这将创建标准的目录结构。

#### 2. 填写 P0 项目基本信息

手动编辑 `00_项目总览/P0_项目基本信息.md`

#### 3. 建立产品基线(A 类文档)

```bash
prd baseline create A0  # 产品基础与范围说明
prd baseline create A1  # 已上线功能与流程清单
prd baseline create A2  # 存量反馈与数据汇总
prd baseline create R0  # 基线审视报告
```

#### 4. 开始第一轮迭代

```bash
prd iteration new
# 这会创建 R1_规划启动条件检查.md
# 填写并确认三个启动条件全部满足后，才能继续
```

#### 5. 需求规划(B 类文档)

```bash
prd plan create B1  # 需求规划草案
prd plan create B2  # 规划拆解与范围界定
prd review r1       # 执行 R1 审视
prd plan freeze     # 如果通过，冻结规划
```

#### 6. 版本需求(C 类文档)

```bash
prd version create C0  # 版本范围声明
prd version create C1  # 版本需求清单
prd review r2          # 执行 R2 审视
prd version freeze     # 如果通过，冻结版本
```

#### 7. 查看项目状态

```bash
prd status          # 查看当前项目状态
prd iteration list  # 查看所有迭代
prd check           # 规则校验
prd stats           # 统计报告
```

---

## 11. 典型使用场景

### 场景一：启动新产品

```bash
prd init new-product
cd new-product
prd baseline create A0
# 填写产品基础信息...
prd baseline create A1
# 梳理现有功能...
prd iteration new
# 开始第一轮规划...
```

### 场景二：现有产品新增功能

```bash
cd existing-product
prd iteration new
# 填写 R1 启动条件检查
# 确认满足三个条件后...
prd plan create B1
# 与 AI 讨论规划草案...
prd review r1
# AI 执行审视并通过后...
prd plan freeze
```

### 场景三：多轮迭代

```bash
prd iteration list     # 查看历史迭代
prd iteration current  # 确认当前迭代
prd iteration new      # 开始新一轮
```

### 场景四：与 AI 协作

```
# 在 Cursor/Windsurf 中

我已经完成了 B1、B2 文档。

请你扮演【产品规划审视官】,按照以下 5 个维度审视:
1. 目标清晰性
2. 场景真实性
3. 现状一致性
4. 范围收敛性
5. 版本化准备度

请参考:
- 01_产品基线/ 下的 A 类文档
- 当前迭代的 B1、B2 文档
- .agent/workflows/prd-r1-review.md 中的详细指令

请在 R1_规划审视报告.md 中填写审视结果,
并给出明确的通过/不通过结论。
```

---

## 12. 常见问题解答

### Q1: 必须严格按顺序吗？

**A**: 是的。这是强制流程：
```
A → R1 启动检查 → B1/B2 → R1 审视 → B3 → C0/C1 → R2 审视 → C3
```

任何跳过都可能导致：
- 规划膨胀
- 需求蔓延
- 反复返工

### Q2: R1 不通过怎么办？

**A**: 有三种情况：

1. **不通过**: 说明这个问题不该开启规划
   - 可能是小修小补，不需要独立迭代
   - 可能问题还没想清楚
   - 建议: 先解决启动条件问题

2. **有条件通过**: 补充指定内容后可通过
   - 修改 B1/B2
   - 重新执行 `prd review r1`

3. **通过**: 执行 `prd plan freeze`

### Q3: 基线文档一定要做吗？

**A**: 第一轮迭代前必须做，后续迭代可以：
- 直接使用（如果产品稳定）
- 更新（如果有重大变化）

**不做基线的风险**：
- AI 会假设不存在的能力
- 规划会"从零重建"
- 失去现状约束

### Q4: 可以同时进行多个迭代吗？

**A**: 每个项目同时只能有一个活跃迭代。

原因：
- 每个迭代都需要审视
- 并行会导致冲突和混乱

如果有多个需求：
- 在 B2 中全部列出
- 排优先级
- 分批进入版本

### Q5: B3 冻结后还能改吗？

**A**: 不建议，除非：
- 外部约束变化（如合规要求）
- 发现重大风险

修改流程：
1. 说明变更原因
2. 更新 B3
3. 重新执行 R1 审视
4. 如果已进入 C 阶段，需要同步更新

### Q6: 与传统 PRD 的区别？

**A**: 

| 传统 PRD | PRD-CLI |
|----------|---------|
| 一次写完 | 分阶段，有闸门 |
| 想到哪写到哪 | 强制基于现状(A 类) |
| 需求容易膨胀 | R1/R2 审视控制 |
| 规划和版本混在一起 | B/C 严格分离 |
| 人工审查 | AI 可执行审视 |

### Q7: 适合什么规模的项目？

**A**: 

- ✅ **适合**: 需要多轮迭代的产品
- ✅ **适合**: 团队需要规范约束
- ✅ **适合**: 与 AI 协作开发
- ⚠️ **可选**: 一次性项目
- ⚠️ **可选**: 原型验证阶段

### Q8: 如何更新工作流和规则文件？

**A**: 使用 `prd upgrade` 命令：

```bash
# 方式一：自动更新（推荐）
npm uninstall prd-workflow-cli
npm install prd-workflow-cli
# 安装完成后会自动更新项目中的配置文件

# 方式二：手动更新
prd upgrade              # 执行更新
prd upgrade --dry-run    # 预览将要更新的文件
prd upgrade --force      # 强制更新
```

---

## 13. 版本历史

### v1.4.0 - 规则系统

- ✨ 新增 `prd check` 规则校验命令
- ✨ 新增 `prd stats` 统计报告命令
- 🔧 完善规则校验机制

### v1.1.25 - 自动更新

- ✨ 新增自动更新（postinstall）机制
- ✨ 新增 `prd upgrade` 手动升级命令
- 🔧 安装时自动更新 workflows 和 AI 规则文件

### v1.1.9 - R0 PM 确认机制

- 🔧 R0 创建添加 PM 确认机制
- 🔧 增加前置条件检查

### v1.1.8 - 流程跳跃修复

- 🔧 修复 R0-R1 流程跳跃问题
- 🔧 强化阶段边界控制

### v1.1.7 - AI 规则配置

- ✨ 新增 `.cursorrules` 规则文件
- ✨ 新增 `.antigravity/` 规则目录
- 🔧 项目初始化增强

### v1.1.6 - 对话归档

- ✨ 新增对话归档机制
- 🔧 工作流增加归档要求

### v1.1.0 - 首个正式版

- ✨ 完整的 A→R→B→C 工作流
- ✨ 基线/迭代/规划/版本管理功能
- ✨ 审视机制（R0/R1/R2）
- ✨ 对话归档功能

---

## 📮 反馈与贡献

- **问题反馈**: [GitHub Issues](https://github.com/houtonghoutong/PRD-CLI/issues)
- **代码贡献**: 欢迎提交 Pull Request!
- **作者**: Hou Tong

---

**许可证**: MIT

---

> **核心价值**: 让 AI 从"陪你写需求"变成"帮你挡住不该写的需求"
